<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Ray Tracing Simulation - Metallic Spheres above Potsdamer Platz - Babylon.js</title>
    <style>
        html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; }
        #renderCanvas { width:100%; height:100%; display:block; touch-action:none; }
    </style>
</head>
<body>
<canvas id="renderCanvas"></canvas>

<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>

<script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });

    const scene = new BABYLON.Scene(engine);

    // Arc rotate camera looking slightly down at the spheres
    const camera = new BABYLON.ArcRotateCamera("cam", -Math.PI / 2, Math.PI / 3, 80, new BABYLON.Vector3(0, 8, 0), scene);
    camera.attachControl(canvas, true);
    camera.lowerRadiusLimit = 10;
    camera.upperRadiusLimit = 150;
    camera.wheelDeltaPercentage = 0.01;

    // Load real street HDR (Potsdamer Platz - beautiful daylight street scene from Poly Haven CC0)
    const hdrTexture = new BABYLON.HDRCubeTexture("https://dl.polyhaven.com/file/ph-assets/HDRIs/hdr/2k/potsdamer_platz_2k.hdr", scene, 512, false, true, false, true);
    scene.environmentTexture = hdrTexture;
    scene.environmentIntensity = 1.4;

    // Skybox = the street HDR so the background itself is the street scene
    scene.createDefaultSkybox(hdrTexture, true, 1000, 0.1); // slight blur for realism

    // Two metallic spheres with different default settings so you can compare
    const mat1 = new BABYLON.PBRMaterial("mat1", scene);
    mat1.metallic = 1.0;
    mat1.roughness = 0.0;          // perfect mirror
    mat1.albedoColor = new BABYLON.Color3(0.9, 0.9, 1.0); // slightly blue-tinted chrome

    const mat2 = new BABYLON.PBRMaterial("mat2", scene);
    mat2.metallic = 1.0;
    mat2.roughness = 0.35;         // brushed metal look
    mat2.albedoColor = new BABYLON.Color3(1.0, 0.71, 0.29); // gold

    const sphere1 = BABYLON.MeshBuilder.CreateSphere("sphere1", {diameter: 10, segments: 64}, scene);
    sphere1.position = new BABYLON.Vector3(-12, 10, 5);
    sphere1.material = mat1;

    const sphere2 = BABYLON.MeshBuilder.CreateSphere("sphere2", {diameter: 10, segments: 64}, scene);
    sphere2.position = new BABYLON.Vector3(12, 10, -8);
    sphere2.material = mat2;

    // GUI - fully featured sliders for both spheres
    const ui = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

    const panel = new BABYLON.GUI.StackPanel();
    panel.width = "280px";
    panel.paddingLeft = "20px";
    panel.isVertical = true;
    panel.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
    panel.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
    ui.addControl(panel);

    function createSlider(labelText, min, max, initialValue, onChange) {
        const header = new BABYLON.GUI.TextBlock();
        header.text = `${labelText}: ${initialValue.toFixed(2)}`;
        header.height = "40px";
        header.color = "white";
        header.fontSize = 20;
        header.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
        panel.addControl(header);

        const slider = new BABYLON.GUI.Slider();
        slider.minimum = min;
        slider.maximum = max;
        slider.value = initialValue;
        slider.height = "20px";
        slider.width = "250px";
        slider.color = "#00ffff";
        slider.background = "#222";
        slider.onValueChangedObservable.add((v) => {
            header.text = `${labelText}: ${v.toFixed(2)}`;
            onChange(v);
        });
        panel.addControl(slider);
        return slider;
    }

    createSlider("Roughness Left", 0, 1, 0.0, v => mat1.roughness = v);
    createSlider("Metallic Left", 0, 1, 1.0, v => mat1.metallic = v);
    createSlider("Roughness Right", 0, 1, 0.35, v => mat2.roughness = v);
    createSlider("Metallic Right", 0, 1, 1.0, v => mat2.metallic = v);
    createSlider("Env Intensity", 0, 5, 1.4, v => scene.environmentIntensity = v);

    // Subtle auto-rotation for nice animation
    scene.registerBeforeRender(() => {
        camera.alpha += 0.003;
    });

    engine.runRenderLoop(() => scene.render());

    window.addEventListener("resize", () => engine.resize());
</script>
</body>
</html>