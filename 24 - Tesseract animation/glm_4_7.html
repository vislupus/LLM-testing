<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 4D Tesseract Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        :root {
            --bg-color: #0d0d12;
            --panel-bg: rgba(20, 20, 25, 0.85);
            --text-color: #e0e0e0;
            --accent-color: #00bcd4;
            --highlight-color: #ff4081;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; /* Prevent scrollbars */
            display: flex;
            height: 100vh;
        }

        #canvas-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, #1a1a24 0%, #000000 100%);
        }

        canvas {
            box-shadow: 0 0 50px rgba(0, 188, 212, 0.1);
        }

        /* UI Panel */
        #controls {
            width: 320px;
            height: 100vh;
            background-color: var(--panel-bg);
            backdrop-filter: blur(10px);
            border-right: 1px solid #333;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            z-index: 10;
        }

        h2 { margin: 0 0 5px 0; font-size: 1.4rem; color: var(--accent-color); border-bottom: 1px solid #444; padding-bottom: 10px;}
        h3 { margin: 10px 0 5px 0; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 1px; color: #888; }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label { font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; }
        
        input[type=range] {
            width: 100%;
            accent-color: var(--accent-color);
            cursor: pointer;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            cursor: pointer;
            background: #2a2a35;
            padding: 5px 8px;
            border-radius: 4px;
            border: 1px solid #444;
            transition: 0.2s;
        }
        
        .checkbox-item:hover { background: #333; }
        .checkbox-item input { margin-right: 8px; }

        button {
            background-color: var(--accent-color);
            color: #000;
            border: none;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover { background-color: #00acc1; }
        button.secondary { background-color: #444; color: white; }
        button.secondary:hover { background-color: #555; }

        .info-box {
            font-size: 0.75rem;
            color: #888;
            line-height: 1.4;
            background: #111;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid var(--highlight-color);
        }

        .value-display { color: var(--accent-color); font-family: monospace; }
    </style>
</head>
<body>

    <div id="controls">
        <h2>4D Tesseract</h2>
        
        <div class="info-box">
            Visualizing a 4D hypercube projected into 3D space, then rendered on a 2D screen.
        </div>

        <h3>Playback</h3>
        <div class="control-group">
            <button id="btnPause">Pause Animation</button>
        </div>

        <h3>Projection Settings</h3>
        <div class="control-group">
            <label>
                4D Camera Dist
                <span id="valDist" class="value-display">2.0</span>
            </label>
            <input type="range" id="sliderDist" min="1.5" max="5.0" step="0.1" value="2.0">
        </div>

        <div class="control-group">
            <label>
                3D FOV
                <span id="valFOV" class="value-display">600</span>
            </label>
            <input type="range" id="sliderFOV" min="300" max="1000" step="10" value="600">
        </div>

        <div class="control-group">
            <label style="cursor: pointer;">
                <span>Perspective 3D Projection</span>
                <input type="checkbox" id="checkPerspective" checked>
            </label>
        </div>

        <h3>4D Rotation Planes</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" id="rotXY" checked> XY Plane</label>
            <label class="checkbox-item"><input type="checkbox" id="rotXZ"> XZ Plane</label>
            <label class="checkbox-item"><input type="checkbox" id="rotXW" checked> XW Plane</label>
            <label class="checkbox-item"><input type="checkbox" id="rotYW" checked> YW Plane</label>
            <label class="checkbox-item"><input type="checkbox" id="rotZW" checked> ZW Plane</label>
        </div>

        <div class="control-group" style="margin-top: 10px;">
            <label>
                Rotation Speed
                <span id="valSpeed" class="value-display">1.0</span>
            </label>
            <input type="range" id="sliderSpeed" min="0" max="5.0" step="0.1" value="1.0">
        </div>

        <h3>Presets</h3>
        <div class="control-group">
            <button class="secondary" onclick="setPreset('default')">Default Morph</button>
            <button class="secondary" onclick="setPreset('tumble')">4D Tumble</button>
            <button class="secondary" onclick="setPreset('cube')">Static Cube</button>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script>
        // --- 4D MATH CLASSES & HELPERS ---

        class P4Vector {
            constructor(x, y, z, w) {
                this.x = x; this.y = y; this.z = z; this.w = w;
            }
        }

        // --- GLOBAL VARIABLES ---
        let points = [];
        let edges = [];
        
        // State
        let angle = 0;
        let isPaused = false;
        let rotationSpeed = 0.01;
        
        // Parameters
        let distance4D = 2.0;
        let fov3D = 600;
        let usePerspective3D = true;

        // UI Elements
        let sliderDist, sliderFOV, sliderSpeed, checkPerspective, btnPause;
        let checks = { XY: null, XZ: null, XW: null, YW: null, ZW: null };

        // --- SETUP ---

        function setup() {
            const container = document.getElementById('canvas-container');
            const canvas = createCanvas(container.clientWidth, container.clientHeight);
            canvas.parent('canvas-container');
            
            // Initialize Geometry
            generateTesseract();

            // Setup UI References
            sliderDist = document.getElementById('sliderDist');
            sliderFOV = document.getElementById('sliderFOV');
            sliderSpeed = document.getElementById('sliderSpeed');
            checkPerspective = document.getElementById('checkPerspective');
            btnPause = document.getElementById('btnPause');

            checks.XY = document.getElementById('rotXY');
            checks.XZ = document.getElementById('rotXZ');
            checks.XW = document.getElementById('rotXW');
            checks.YW = document.getElementById('rotYW');
            checks.ZW = document.getElementById('rotZW');

            // UI Event Listeners
            sliderDist.addEventListener('input', (e) => {
                distance4D = parseFloat(e.target.value);
                document.getElementById('valDist').innerText = distance4D.toFixed(1);
            });
            sliderFOV.addEventListener('input', (e) => {
                fov3D = parseInt(e.target.value);
                document.getElementById('valFOV').innerText = fov3D;
            });
            sliderSpeed.addEventListener('input', (e) => {
                rotationSpeed = parseFloat(e.target.value);
                document.getElementById('valSpeed').innerText = rotationSpeed.toFixed(1);
            });
            checkPerspective.addEventListener('change', (e) => {
                usePerspective3D = e.target.checked;
            });
            btnPause.addEventListener('click', () => {
                isPaused = !isPaused;
                btnPause.innerText = isPaused ? "Resume Animation" : "Pause Animation";
                btnPause.style.backgroundColor = isPaused ? "#ff9800" : "#00bcd4";
            });

            // Window resize
            window.addEventListener('resize', () => {
                resizeCanvas(container.clientWidth, container.clientHeight);
            });
        }

        function generateTesseract() {
            // Generate 16 vertices (coordinates -1 to 1)
            for (let x = -1; x <= 1; x += 2) {
                for (let y = -1; y <= 1; y += 2) {
                    for (let z = -1; z <= 1; z += 2) {
                        for (let w = -1; w <= 1; w += 2) {
                            points.push(new P4Vector(x, y, z, w));
                        }
                    }
                }
            }

            // Generate Edges (connect vertices if Hamming distance is 1)
            for (let i = 0; i < points.length; i++) {
                for (let j = i + 1; j < points.length; j++) {
                    let diff = 0;
                    let p1 = points[i];
                    let p2 = points[j];
                    if (p1.x !== p2.x) diff++;
                    if (p1.y !== p2.y) diff++;
                    if (p1.z !== p2.z) diff++;
                    if (p1.w !== p2.w) diff++;
                    
                    if (diff === 1) {
                        edges.push([i, j]);
                    }
                }
            }
        }

        // --- MAIN LOOP ---

        function draw() {
            background(13, 13, 18); // Dark background
            
            // Center of screen
            translate(width / 2, height / 2);

            if (!isPaused) {
                angle += rotationSpeed * 0.01;
            }

            // 1. Rotate and Project Points
            let projected = [];
            
            for (let i = 0; i < points.length; i++) {
                let v = points[i];
                
                // --- 4D ROTATION ---
                // We apply rotations sequentially based on checked boxes.
                // Note: In 4D, rotation happens in a plane, not around an axis.
                
                let x = v.x;
                let y = v.y;
                let z = v.z;
                let w = v.w;

                // XY Plane (Standard 2D rotation)
                if (checks.XY.checked) {
                    let tx = x * cos(angle) - y * sin(angle);
                    let ty = x * sin(angle) + y * cos(angle);
                    x = tx; y = ty;
                }

                // XZ Plane (Standard 3D X-axis rotation equivalent)
                if (checks.XZ.checked) {
                    let tx = x * cos(angle) - z * sin(angle);
                    let tz = x * sin(angle) + z * cos(angle);
                    x = tx; z = tz;
                }

                // XW Plane (4D Rotation mixing X and W)
                if (checks.XW.checked) {
                    let tx = x * cos(angle) - w * sin(angle);
                    let tw = x * sin(angle) + w * cos(angle);
                    x = tx; w = tw;
                }

                // YW Plane (4D Rotation mixing Y and W)
                if (checks.YW.checked) {
                    let ty = y * cos(angle) - w * sin(angle);
                    let tw = y * sin(angle) + w * cos(angle);
                    y = ty; w = tw;
                }

                // ZW Plane (4D Rotation mixing Z and W)
                if (checks.ZW.checked) {
                    let tz = z * cos(angle) - w * sin(angle);
                    let tw = z * sin(angle) + w * cos(angle);
                    z = tz; w = tw;
                }

                // --- 4D TO 3D PROJECTION ---
                // Project from 4D (x,y,z,w) to 3D (x,y,z)
                // Camera is at w = -distance4D. We project onto w = 0.
                // Formula: scale = d / (d + w)
                // (Assuming w is between -1 and 1, and camera is at negative w)
                let wDistance = distance4D;
                let scale4D = wDistance / (wDistance + w);

                let x3d = x * scale4D;
                let y3d = y * scale4D;
                let z3d = z * scale4D;

                // --- 3D TO 2D PROJECTION ---
                let x2d, y2d, scaleFactor, depth;

                if (usePerspective3D) {
                    // Perspective: scale = fov / (fov + z)
                    // We push the object back a bit so it doesn't clip with camera at z=0
                    let zOffset = 4; 
                    scaleFactor = fov3D / (fov3D + z3d + zOffset);
                    x2d = x3d * scaleFactor * 200; // 200 is zoom factor
                    y2d = y3d * scaleFactor * 200;
                    depth = z3d; // Store for color shading
                } else {
                    // Orthographic: just drop Z
                    scaleFactor = 1;
                    x2d = x3d * 200;
                    y2d = y3d * 200;
                    depth = z3d;
                }

                projected.push({ x: x2d, y: y2d, z: depth });
            }

            // 2. Draw Edges
            noFill();
            
            for (let i = 0; i < edges.length; i++) {
                let idx1 = edges[i][0];
                let idx2 = edges[i][1];
                
                let p1 = projected[idx1];
                let p2 = projected[idx2];

                // Calculate color based on average depth (Z in 3D space)
                // This helps distinguish inner vs outer structure
                let avgZ = (p1.z + p2.z) / 2;
                
                // Map Z (-2 to 2 approx) to a color gradient
                // Deeper (negative) -> Blue/Purple, Closer (positive) -> Cyan/White
                let t = map(avgZ, -2, 2, 0, 1);
                t = constrain(t, 0, 1);
                
                let strokeCol = lerpColor(color(0, 100, 255), color(0, 255, 255), t);
                
                // Make outer edges thicker/brighter
                strokeWeight(map(t, 0, 1, 1, 3));
                stroke(strokeCol);
                
                // Add a subtle glow effect by drawing twice (thick transparent + thin opaque)
                if (t > 0.8) {
                    stroke(255, 255, 255, 50);
                    strokeWeight(6);
                    line(p1.x, p1.y, p2.x, p2.y);
                    stroke(strokeCol);
                    strokeWeight(2);
                    line(p1.x, p1.y, p2.x, p2.y);
                } else {
                    line(p1.x, p1.y, p2.x, p2.y);
                }
            }

            // 3. Draw Vertices (Optional, adds nice detail)
            noStroke();
            for (let p of projected) {
                let t = map(p.z, -2, 2, 0, 1);
                let col = lerpColor(color(100, 100, 255), color(255, 255, 255), t);
                fill(col);
                ellipse(p.x, p.y, map(t, 0, 1, 4, 8));
            }
        }

        // --- PRESETS LOGIC ---
        
        window.setPreset = function(type) {
            // Uncheck all first
            Object.values(checks).forEach(cb => cb.checked = false);

            if (type === 'default') {
                // The classic Tesseract rotation
                checks.XY.checked = true;
                checks.XW.checked = true;
                checks.YW.checked = true;
                sliderSpeed.value = 1.0;
            } else if (type === 'tumble') {
                // All 4D planes active
                checks.XW.checked = true;
                checks.YW.checked = true;
                checks.ZW.checked = true;
                sliderSpeed.value = 1.5;
            } else if (type === 'cube') {
                // Only 3D planes, looks like a rotating cube
                checks.XY.checked = true;
                checks.XZ.checked = true;
                sliderSpeed.value = 0.5;
            }
            
            // Trigger input events to update JS state if needed
            sliderSpeed.dispatchEvent(new Event('input'));
            angle = 0; // Reset angle to see the clean transition
        };

    </script>
</body>
</html>