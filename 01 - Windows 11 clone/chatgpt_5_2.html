<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Windows 11 Desktop (Standalone Mock)</title>
  <style>
    :root{
      --taskbar-h: 52px;
      --win-radius: 14px;
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --stroke: rgba(255,255,255,.18);
      --glass: rgba(22,25,32,.55);
      --glass2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --accent: #3aa0ff;
      --danger: #ff5a5f;
      --ok: #34c759;
      --warn: #ffd60a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --ui: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; margin:0; font-family: var(--ui); color: var(--text); overflow:hidden; }

    /* NOTE:
       You asked for the original Windows 11 wallpaper + original app icons.
       Those are copyrighted assets, so this file uses a Windows-11-style wallpaper (SVG)
       and custom SVG icons instead. If you own the assets, replace the wallpaper data-URI
       in #wallpaper and replace the inline SVGs in the icons.
    */

    #wallpaper{
      position:fixed; inset:0;
      background:
        radial-gradient(1200px 800px at 70% 30%, rgba(75,175,255,.35), transparent 60%),
        radial-gradient(1000px 700px at 25% 70%, rgba(90,90,255,.25), transparent 55%),
        linear-gradient(120deg, #071422, #0b2a4f 35%, #0b1940 70%, #061327);
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1920' height='1080' viewBox='0 0 1920 1080'%3E%3Cdefs%3E%3CradialGradient id='g1' cx='60%25' cy='38%25' r='75%25'%3E%3Cstop offset='0%25' stop-color='%234fd0ff' stop-opacity='.55'/%3E%3Cstop offset='45%25' stop-color='%232e78ff' stop-opacity='.18'/%3E%3Cstop offset='100%25' stop-color='%23000000' stop-opacity='0'/%3E%3C/radialGradient%3E%3CradialGradient id='g2' cx='28%25' cy='70%25' r='75%25'%3E%3Cstop offset='0%25' stop-color='%237d7bff' stop-opacity='.42'/%3E%3Cstop offset='55%25' stop-color='%231b4cff' stop-opacity='.16'/%3E%3Cstop offset='100%25' stop-color='%23000000' stop-opacity='0'/%3E%3C/radialGradient%3E%3ClinearGradient id='s' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%234fd0ff' stop-opacity='.9'/%3E%3Cstop offset='55%25' stop-color='%232e78ff' stop-opacity='.9'/%3E%3Cstop offset='100%25' stop-color='%231c2bff' stop-opacity='.9'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1920' height='1080' fill='%23061422'/%3E%3Crect width='1920' height='1080' fill='url(%23g1)'/%3E%3Crect width='1920' height='1080' fill='url(%23g2)'/%3E%3Cg opacity='.9'%3E%3Cpath d='M210 650 C 460 380, 760 340, 950 480 C 1170 640, 1250 830, 1460 860 C 1660 890, 1760 760, 1860 680 L 1860 1080 L 210 1080 Z' fill='url(%23s)' opacity='.35'/%3E%3Cpath d='M50 720 C 330 520, 610 520, 900 640 C 1160 750, 1390 980, 1660 930 C 1780 905, 1880 830, 1970 760 L 1970 1080 L 50 1080 Z' fill='url(%23s)' opacity='.25'/%3E%3Cpath d='M150 500 C 410 270, 740 230, 1020 400 C 1250 540, 1290 740, 1510 760 C 1690 775, 1820 650, 1940 560' fill='none' stroke='%23a8e9ff' stroke-opacity='.45' stroke-width='28' stroke-linecap='round'/%3E%3Cpath d='M90 560 C 340 360, 660 340, 920 500 C 1190 670, 1240 860, 1500 900 C 1710 930, 1850 800, 1960 720' fill='none' stroke='%232e78ff' stroke-opacity='.35' stroke-width='22' stroke-linecap='round'/%3E%3C/g%3E%3C/svg%3E");
      background-size: cover;
      background-position: center;
      filter: saturate(1.15) contrast(1.03);
      transform: scale(1.01);
    }

    #desktop{
      position:fixed; inset:0;
      padding: 18px 18px calc(var(--taskbar-h) + 18px) 18px;
    }

    .icon-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      max-width: 520px;
      gap: 14px;
      align-content: start;
      user-select:none;
    }
    .desktop-icon{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 8px;
      padding: 10px 8px;
      border-radius: 12px;
      cursor: default;
      outline:none;
    }
    .desktop-icon:hover{ background: rgba(255,255,255,.08); }
    .desktop-icon:active{ background: rgba(255,255,255,.12); }
    .desktop-icon .label{
      font-size: 12px;
      text-align:center;
      text-shadow: 0 2px 10px rgba(0,0,0,.55);
      max-width: 92px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Taskbar */
    #taskbar{
      position:fixed; left:0; right:0; bottom:0;
      height: var(--taskbar-h);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 8px 10px;
      pointer-events:none;
    }
    #taskbar .bar{
      pointer-events:auto;
      height: 100%;
      min-width: min(760px, 92vw);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 8px 10px;
      border-radius: 16px;
      background: rgba(20,22,30,.55);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 14px 50px rgba(0,0,0,.35);
    }
    .task-center{
      display:flex;
      gap: 8px;
      align-items:center;
      justify-content:center;
      flex: 1;
    }
    .task-btn{
      width: 40px; height: 36px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      cursor:pointer;
      background: transparent;
      border: 1px solid transparent;
    }
    .task-btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.10); }
    .task-btn.active{ background: rgba(58,160,255,.16); border-color: rgba(58,160,255,.22); }
    .tray{
      display:flex; align-items:center; gap: 10px;
      padding-left: 12px;
    }
    .clock{
      font-size: 12px; line-height: 1.1;
      text-align:right;
      color: rgba(255,255,255,.85);
      padding: 0 8px;
      border-radius: 10px;
    }

    /* Windows */
    #windows{
      position:fixed; inset:0;
      pointer-events:none;
    }
    .window{
      position:absolute;
      width: 820px;
      height: 520px;
      min-width: 340px;
      min-height: 240px;
      border-radius: var(--win-radius);
      background: rgba(20,22,30,.62);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      overflow:hidden;
      pointer-events:auto;
    }
    .window.focused{
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 22px 75px rgba(0,0,0,.45);
    }
    .titlebar{
      height: 44px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 10px 0 12px;
      background: linear-gradient(to bottom, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border-bottom: 1px solid rgba(255,255,255,.10);
      cursor: grab;
      user-select:none;
    }
    .titlebar:active{ cursor: grabbing; }
    .title-left{
      display:flex; align-items:center; gap: 10px;
      min-width: 0;
    }
    .title-left .appname{
      font-size: 13px;
      color: rgba(255,255,255,.90);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 440px;
    }
    .win-controls{
      display:flex; gap: 6px;
    }
    .win-btn{
      width: 38px; height: 30px;
      border-radius: 10px;
      display:grid; place-items:center;
      cursor:pointer;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .win-btn:hover{ background: rgba(255,255,255,.11); }
    .win-btn.close:hover{ background: rgba(255,90,95,.20); border-color: rgba(255,90,95,.25); }

    .content{
      height: calc(100% - 44px);
      display:flex;
      flex-direction:column;
    }

    /* Shared UI */
    .toolbar{
      display:flex; align-items:center; gap: 8px;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      flex-wrap: wrap;
    }
    .toolbtn, .toolinput, select{
      height: 32px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding: 0 10px;
      font-size: 13px;
      outline:none;
    }
    .toolbtn{
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .toolbtn:hover{ background: rgba(255,255,255,.08); }
    .toolbtn.primary{
      border-color: rgba(58,160,255,.26);
      background: rgba(58,160,255,.18);
    }
    .split{
      flex:1;
    }
    .panel{
      padding: 12px;
      height: 100%;
      overflow:auto;
    }

    /* Word */
    .ribbon{ gap: 6px; }
    .doc{
      margin: 14px auto;
      width: min(760px, 92%);
      min-height: 900px;
      background: rgba(255,255,255,.94);
      color: #111;
      border-radius: 12px;
      padding: 22px 22px;
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
      outline: none;
    }
    .doc:focus{ box-shadow: 0 18px 55px rgba(0,0,0,.30); }

    /* Notepad */
    textarea.notepad{
      width: 100%;
      height: 100%;
      resize:none;
      border:none;
      outline:none;
      padding: 14px;
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      font-family: var(--mono);
      font-size: 13px;
      line-height: 1.45;
    }

    /* Paint */
    .paint-wrap{ display:flex; flex-direction:column; height:100%; }
    .paint-canvas-wrap{
      flex:1;
      padding: 12px;
      overflow:hidden;
      display:grid;
      place-items:center;
      background: radial-gradient(700px 400px at 50% 20%, rgba(255,255,255,.08), transparent 60%);
    }
    canvas#paintCanvas{
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 16px 50px rgba(0,0,0,.35);
      touch-action: none;
    }

    /* Calculator */
    .calc{
      height:100%;
      display:flex;
      flex-direction:column;
      padding: 12px;
      gap: 10px;
    }
    .calc-display{
      height: 70px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.28);
      padding: 10px 12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 4px;
    }
    .calc-display .expr{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.65);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .calc-display .val{
      font-family: var(--mono);
      font-size: 22px;
      color: rgba(255,255,255,.95);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .calc-grid{
      flex:1;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    .calc-btn{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-size: 14px;
      cursor:pointer;
      min-height: 46px;
    }
    .calc-btn:hover{ background: rgba(255,255,255,.10); }
    .calc-btn.op{ background: rgba(58,160,255,.14); border-color: rgba(58,160,255,.22); }
    .calc-btn.eq{ background: rgba(52,199,89,.16); border-color: rgba(52,199,89,.25); }
    .calc-btn.danger{ background: rgba(255,90,95,.12); border-color: rgba(255,90,95,.22); }

    /* Explorer */
    .explorer{
      display:grid;
      grid-template-columns: 240px 1fr;
      height: 100%;
    }
    .sidebar{
      border-right: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      padding: 10px;
      overflow:auto;
    }
    .side-item{
      padding: 10px;
      border-radius: 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 10px;
      color: rgba(255,255,255,.88);
    }
    .side-item:hover{ background: rgba(255,255,255,.08); }
    .side-item.active{ background: rgba(58,160,255,.16); border: 1px solid rgba(58,160,255,.22); }
    .files{
      padding: 10px;
      overflow:auto;
    }
    .path{
      display:flex;
      gap: 8px;
      align-items:center;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
    }
    .path input{
      flex: 1;
    }
    .file-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      padding: 12px 6px;
    }
    .file{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 14px;
      padding: 10px;
      cursor:pointer;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .file:hover{ background: rgba(255,255,255,.08); }
    .file .meta{ min-width:0; }
    .file .name{
      font-size: 13px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .file .desc{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Chrome */
    .chrome{
      height:100%;
      display:flex;
      flex-direction:column;
    }
    .omnibox{
      display:flex;
      gap: 8px;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .omnibox input{
      flex: 1;
    }
    .webview{
      flex:1;
      overflow:auto;
      padding: 12px;
    }
    .page{
      max-width: 900px;
      margin: 0 auto;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 16px 16px;
    }
    .page h1{ margin: 6px 0 8px; font-size: 18px; }
    .page p{ margin: 8px 0; color: rgba(255,255,255,.82); line-height: 1.45; }
    .chips{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 10px; }
    .chip{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 13px;
      color: rgba(255,255,255,.90);
    }
    .chip:hover{ background: rgba(255,255,255,.10); }

    /* Resizer */
    .window{
      resize: both;
    }

    /* Small screens */
    @media (max-width: 900px){
      .window{ width: 92vw !important; height: 68vh !important; }
      .explorer{ grid-template-columns: 1fr; }
      .sidebar{ display:none; }
    }

    /* SVG icon sizing */
    .ico{ width: 46px; height: 46px; filter: drop-shadow(0 10px 24px rgba(0,0,0,.25)); }
    .ico.small{ width: 22px; height: 22px; filter:none; }
  </style>
</head>

<body>
  <div id="wallpaper" aria-hidden="true"></div>

  <div id="desktop">
    <div class="icon-grid" id="iconGrid">
      <div class="desktop-icon" tabindex="0" data-app="word" title="MS Word">
        <!-- Custom Word-like icon (not the original) -->
        <svg class="ico" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="wbg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#2f80ff"/>
              <stop offset="1" stop-color="#1346d6"/>
            </linearGradient>
          </defs>
          <rect x="8" y="10" width="48" height="44" rx="14" fill="url(#wbg)" />
          <rect x="14" y="16" width="24" height="32" rx="10" fill="rgba(255,255,255,.14)"/>
          <path d="M24 40 L20 26 h3 l2 9 2-9h3l2 9 2-9h3l-4 14h-3l-2-8-2 8z"
                fill="#fff" opacity=".92"/>
          <rect x="40" y="20" width="14" height="3" rx="1.5" fill="rgba(255,255,255,.75)"/>
          <rect x="40" y="27" width="16" height="3" rx="1.5" fill="rgba(255,255,255,.62)"/>
          <rect x="40" y="34" width="12" height="3" rx="1.5" fill="rgba(255,255,255,.55)"/>
          <rect x="40" y="41" width="15" height="3" rx="1.5" fill="rgba(255,255,255,.55)"/>
        </svg>
        <div class="label">Word</div>
      </div>

      <div class="desktop-icon" tabindex="0" data-app="paint" title="Paint">
        <svg class="ico" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="pbg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#ffcc4a"/>
              <stop offset="1" stop-color="#ff7b5c"/>
            </linearGradient>
          </defs>
          <rect x="8" y="10" width="48" height="44" rx="14" fill="url(#pbg)"/>
          <path d="M22 40c-4-5 1-14 10-16s16 3 16 10-6 13-14 12c-5-.5-9-3-12-6z"
                fill="rgba(255,255,255,.9)"/>
          <circle cx="35" cy="31" r="2.1" fill="#ff5a5f"/>
          <circle cx="41" cy="34" r="2.1" fill="#34c759"/>
          <circle cx="30" cy="34" r="2.1" fill="#3aa0ff"/>
          <path d="M44 42l7-7c1-1 1-3 0-4l-2-2c-1-1-3-1-4 0l-7 7z"
                fill="rgba(0,0,0,.22)"/>
          <path d="M41 45l-2 6 6-2z" fill="rgba(0,0,0,.22)"/>
        </svg>
        <div class="label">Paint</div>
      </div>

      <div class="desktop-icon" tabindex="0" data-app="calc" title="Calculator">
        <svg class="ico" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="cbg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#3a3f4b"/>
              <stop offset="1" stop-color="#12141a"/>
            </linearGradient>
          </defs>
        <rect x="8" y="10" width="48" height="44" rx="14" fill="url(#cbg)"/>
        <rect x="16" y="16" width="32" height="10" rx="6" fill="rgba(255,255,255,.12)"/>
        <g fill="rgba(255,255,255,.20)">
          <rect x="16" y="30" width="9" height="7" rx="3"/>
          <rect x="27.5" y="30" width="9" height="7" rx="3"/>
          <rect x="39" y="30" width="9" height="7" rx="3"/>
          <rect x="16" y="39" width="9" height="7" rx="3"/>
          <rect x="27.5" y="39" width="9" height="7" rx="3"/>
          <rect x="39" y="39" width="9" height="7" rx="3"/>
        </g>
        <path d="M21 34h-1.6v-1.6H18v1.6h-1.6V36H18v1.6h1.4V36H21z" fill="rgba(255,255,255,.82)"/>
        <path d="M29 35.2h6" stroke="rgba(255,255,255,.82)" stroke-width="2" stroke-linecap="round"/>
        <path d="M42.2 32.2l3.6 3.6M45.8 32.2l-3.6 3.6" stroke="rgba(255,255,255,.82)" stroke-width="2" stroke-linecap="round"/>
        <path d="M42.2 42h3.6M42.2 45h3.6" stroke="rgba(255,255,255,.82)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <div class="label">Calculator</div>
      </div>

      <div class="desktop-icon" tabindex="0" data-app="notepad" title="Notepad">
        <svg class="ico" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="nbg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#63e6be"/>
              <stop offset="1" stop-color="#2bb673"/>
            </linearGradient>
          </defs>
          <rect x="8" y="10" width="48" height="44" rx="14" fill="url(#nbg)"/>
          <rect x="18" y="16" width="28" height="34" rx="10" fill="rgba(255,255,255,.92)"/>
          <rect x="21" y="22" width="22" height="2.6" rx="1.3" fill="rgba(0,0,0,.30)"/>
          <rect x="21" y="28" width="20" height="2.6" rx="1.3" fill="rgba(0,0,0,.24)"/>
          <rect x="21" y="34" width="22" height="2.6" rx="1.3" fill="rgba(0,0,0,.24)"/>
          <rect x="21" y="40" width="16" height="2.6" rx="1.3" fill="rgba(0,0,0,.24)"/>
          <rect x="18" y="16" width="28" height="8" rx="10" fill="rgba(255,255,255,.35)"/>
        </svg>
        <div class="label">Notepad</div>
      </div>

      <div class="desktop-icon" tabindex="0" data-app="explorer" title="File Explorer">
        <svg class="ico" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="fbg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#ffd36a"/>
              <stop offset="1" stop-color="#ffb000"/>
            </linearGradient>
          </defs>
          <rect x="8" y="10" width="48" height="44" rx="14" fill="url(#fbg)"/>
          <path d="M18 26c0-2 1.6-3.6 3.6-3.6H30l2 2.4h12.4c2 0 3.6 1.6 3.6 3.6v16c0 2-1.6 3.6-3.6 3.6H21.6c-2 0-3.6-1.6-3.6-3.6z"
                fill="rgba(0,0,0,.20)"/>
          <path d="M18 26c0-2 1.6-3.6 3.6-3.6H30l2 2.4h12.4c2 0 3.6 1.6 3.6 3.6v2H18z"
                fill="rgba(255,255,255,.28)"/>
          <rect x="21" y="34" width="22" height="3" rx="1.5" fill="rgba(255,255,255,.65)"/>
          <rect x="21" y="40" width="17" height="3" rx="1.5" fill="rgba(255,255,255,.55)"/>
        </svg>
        <div class="label">File Explorer</div>
      </div>

      <div class="desktop-icon" tabindex="0" data-app="chrome" title="Chrome">
        <svg class="ico" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="xbg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#3aa0ff"/>
              <stop offset="1" stop-color="#1c5cff"/>
            </linearGradient>
          </defs>
          <rect x="8" y="10" width="48" height="44" rx="14" fill="url(#xbg)"/>
          <circle cx="32" cy="32" r="15" fill="rgba(255,255,255,.10)"/>
          <path d="M32 17a15 15 0 0 1 13 7.5H31.5a7 7 0 0 0-6.2 3.8L20 19.2A15 15 0 0 1 32 17z"
                fill="rgba(255,90,95,.90)"/>
          <path d="M45 24.5A15 15 0 0 1 36.2 46l6.8-11.8A7 7 0 0 0 41 28.7z"
                fill="rgba(52,199,89,.90)"/>
          <path d="M36.2 46A15 15 0 0 1 20 19.2l6.8 11.8A7 7 0 0 0 32 39a7 7 0 0 0 4.2-1.4z"
                fill="rgba(255,214,10,.95)"/>
          <circle cx="32" cy="32" r="6.6" fill="rgba(0,0,0,.22)"/>
          <circle cx="32" cy="32" r="5.2" fill="rgba(58,160,255,.95)"/>
        </svg>
        <div class="label">Chrome</div>
      </div>
    </div>
  </div>

  <div id="windows" aria-live="polite"></div>

  <div id="taskbar">
    <div class="bar">
      <div class="task-center" id="taskCenter"></div>
      <div class="tray">
        <div class="clock" id="clock"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  "use strict";

  /* ----------------------------
     Simple window manager
  -----------------------------*/
  const windowsRoot = document.getElementById("windows");
  const taskCenter = document.getElementById("taskCenter");
  const clockEl = document.getElementById("clock");

  let topZ = 10;
  const appState = new Map(); // appId -> {winEl, taskEl}

  const icons = {
    word: svgSmall("word"),
    paint: svgSmall("paint"),
    calc: svgSmall("calc"),
    notepad: svgSmall("notepad"),
    explorer: svgSmall("explorer"),
    chrome: svgSmall("chrome")
  };

  function svgSmall(app){
    const map = {
      word: `<svg class="ico small" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="wbgS" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#2f80ff"/><stop offset="1" stop-color="#1346d6"/></linearGradient></defs>
        <rect x="10" y="12" width="44" height="40" rx="12" fill="url(#wbgS)"/>
        <path d="M27 40l-4-14h3l2 9 2-9h3l2 9 2-9h3l-4 14h-3l-2-8-2 8z" fill="#fff" opacity=".92"/>
      </svg>`,
      paint: `<svg class="ico small" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="pbgS" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#ffcc4a"/><stop offset="1" stop-color="#ff7b5c"/></linearGradient></defs>
        <rect x="10" y="12" width="44" height="40" rx="12" fill="url(#pbgS)"/>
        <path d="M23 39c-3-4 1-12 9-14s14 3 14 9-5 12-12 11c-4-.4-8-3-11-6z" fill="rgba(255,255,255,.9)"/>
      </svg>`,
      calc: `<svg class="ico small" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="cbgS" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#3a3f4b"/><stop offset="1" stop-color="#12141a"/></linearGradient></defs>
        <rect x="10" y="12" width="44" height="40" rx="12" fill="url(#cbgS)"/>
        <rect x="18" y="18" width="28" height="8" rx="5" fill="rgba(255,255,255,.12)"/>
      </svg>`,
      notepad: `<svg class="ico small" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="nbgS" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#63e6be"/><stop offset="1" stop-color="#2bb673"/></linearGradient></defs>
        <rect x="10" y="12" width="44" height="40" rx="12" fill="url(#nbgS)"/>
        <rect x="20" y="18" width="24" height="28" rx="9" fill="rgba(255,255,255,.92)"/>
      </svg>`,
      explorer: `<svg class="ico small" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="fbgS" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#ffd36a"/><stop offset="1" stop-color="#ffb000"/></linearGradient></defs>
        <rect x="10" y="12" width="44" height="40" rx="12" fill="url(#fbgS)"/>
        <path d="M18 28c0-2 1.6-3.6 3.6-3.6H29l2 2.4h11.4c2 0 3.6 1.6 3.6 3.6v12c0 2-1.6 3.6-3.6 3.6H21.6c-2 0-3.6-1.6-3.6-3.6z"
          fill="rgba(0,0,0,.20)"/>
      </svg>`,
      chrome: `<svg class="ico small" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="xbgS" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#3aa0ff"/><stop offset="1" stop-color="#1c5cff"/></linearGradient></defs>
        <rect x="10" y="12" width="44" height="40" rx="12" fill="url(#xbgS)"/>
        <circle cx="32" cy="32" r="10" fill="rgba(255,255,255,.10)"/>
        <circle cx="32" cy="32" r="4.2" fill="rgba(58,160,255,.95)"/>
      </svg>`
    };
    return map[app] || "";
  }

  function setClock(){
    const d = new Date();
    const time = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
    const date = d.toLocaleDateString([], {year:"numeric", month:"2-digit", day:"2-digit"});
    clockEl.textContent = `${time}\n${date}`;
    clockEl.style.whiteSpace = "pre";
  }
  setClock();
  setInterval(setClock, 1000);

  function focusWindow(winEl){
    topZ += 1;
    winEl.style.zIndex = String(topZ);
    document.querySelectorAll(".window").forEach(w => w.classList.remove("focused"));
    winEl.classList.add("focused");
    const appId = winEl.dataset.app;
    document.querySelectorAll(".task-btn").forEach(b => b.classList.toggle("active", b.dataset.app === appId));
  }

  function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

  function makeWindow({appId, title, contentEl, width=820, height=520}){
    // If already open: restore + focus
    const existing = appState.get(appId);
    if (existing){
      existing.winEl.style.display = "block";
      focusWindow(existing.winEl);
      return existing.winEl;
    }

    const win = document.createElement("div");
    win.className = "window focused";
    win.dataset.app = appId;

    // initial position
    const vw = window.innerWidth, vh = window.innerHeight;
    const left = clamp((vw - width)/2 + (Math.random()*40-20), 10, vw - width - 10);
    const top = clamp((vh - height - 60)/2 + (Math.random()*40-20), 10, vh - height - 70);

    win.style.width = width + "px";
    win.style.height = height + "px";
    win.style.left = left + "px";
    win.style.top = top + "px";
    win.style.zIndex = String(++topZ);

    const titlebar = document.createElement("div");
    titlebar.className = "titlebar";
    titlebar.innerHTML = `
      <div class="title-left">
        <span class="app-ico">${icons[appId] || ""}</span>
        <div class="appname">${escapeHtml(title)}</div>
      </div>
      <div class="win-controls">
        <div class="win-btn min" title="Minimize" aria-label="Minimize">—</div>
        <div class="win-btn close" title="Close" aria-label="Close">✕</div>
      </div>
    `;

    const contentWrap = document.createElement("div");
    contentWrap.className = "content";
    contentWrap.appendChild(contentEl);

    win.appendChild(titlebar);
    win.appendChild(contentWrap);
    windowsRoot.appendChild(win);

    // taskbar button
    const taskBtn = document.createElement("button");
    taskBtn.className = "task-btn active";
    taskBtn.type = "button";
    taskBtn.dataset.app = appId;
    taskBtn.title = title;
    taskBtn.innerHTML = icons[appId] || "■";
    taskCenter.appendChild(taskBtn);

    // focus handling
    win.addEventListener("mousedown", () => focusWindow(win));
    taskBtn.addEventListener("click", () => {
      const hidden = win.style.display === "none";
      win.style.display = hidden ? "block" : "none";
      if (hidden) focusWindow(win);
      taskBtn.classList.toggle("active", win.style.display !== "none");
    });

    // controls
    titlebar.querySelector(".win-btn.close").addEventListener("click", () => {
      win.remove();
      taskBtn.remove();
      appState.delete(appId);
      // focus topmost remaining
      const last = [...document.querySelectorAll(".window")].sort((a,b)=>Number(a.style.zIndex)-Number(b.style.zIndex)).pop();
      if (last) focusWindow(last);
    });
    titlebar.querySelector(".win-btn.min").addEventListener("click", () => {
      win.style.display = "none";
      taskBtn.classList.remove("active");
    });

    // drag handling
    installDrag(win, titlebar);

    // keep focused
    focusWindow(win);

    appState.set(appId, {winEl: win, taskEl: taskBtn});
    return win;
  }

  function installDrag(winEl, handleEl){
    let dragging = false;
    let startX=0, startY=0, startL=0, startT=0;
    const onDown = (e) => {
      // avoid dragging when clicking buttons
      if (e.target.closest(".win-controls")) return;
      dragging = true;
      focusWindow(winEl);
      const rect = winEl.getBoundingClientRect();
      startX = e.clientX; startY = e.clientY;
      startL = rect.left; startT = rect.top;
      handleEl.setPointerCapture?.(e.pointerId);
      e.preventDefault();
    };
    const onMove = (e) => {
      if (!dragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const w = winEl.getBoundingClientRect().width;
      const h = winEl.getBoundingClientRect().height;
      const newL = clamp(startL + dx, 0, vw - Math.max(80, w));
      const newT = clamp(startT + dy, 0, vh - Math.max(80, h) - 56);
      winEl.style.left = newL + "px";
      winEl.style.top = newT + "px";
    };
    const onUp = () => { dragging = false; };
    handleEl.addEventListener("pointerdown", onDown);
    window.addEventListener("pointermove", onMove);
    window.addEventListener("pointerup", onUp);
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  /* ----------------------------
     Apps
  -----------------------------*/

  // Shared "Open file" bus (Explorer -> Notepad/Word)
  const fileBus = {
    openTextInNotepad(name, text){
      const win = openNotepad({name, text});
      focusWindow(win);
    },
    openTextInWord(name, html){
      const win = openWord({name, html});
      focusWindow(win);
    }
  };

  function openWord({name="Document", html=null} = {}){
    const content = document.createElement("div");

    const toolbar = document.createElement("div");
    toolbar.className = "toolbar ribbon";
    toolbar.innerHTML = `
      <button class="toolbtn" data-cmd="bold"><b>B</b></button>
      <button class="toolbtn" data-cmd="italic"><i>I</i></button>
      <button class="toolbtn" data-cmd="underline"><u>U</u></button>
      <span style="opacity:.35">|</span>
      <button class="toolbtn" data-cmd="insertUL">• List</button>
      <button class="toolbtn" data-cmd="insertOL">1. List</button>
      <span style="opacity:.35">|</span>
      <button class="toolbtn primary" data-act="download">Download .html</button>
      <button class="toolbtn" data-act="save">Save</button>
      <button class="toolbtn" data-act="load">Load</button>
      <span class="split"></span>
      <span style="font-size:12px;color:rgba(255,255,255,.7)">Autosave: localStorage</span>
    `;

    const panel = document.createElement("div");
    panel.className = "panel";

    const doc = document.createElement("div");
    doc.className = "doc";
    doc.contentEditable = "true";
    doc.spellcheck = true;
    doc.innerHTML = html ?? `<h2 style="margin:0 0 10px"> ${escapeHtml(name)} </h2>
      <p>Type here. This is a lightweight “Word-like” editor running entirely in one HTML file.</p>
      <p>Try <b>bold</b>, <i>italic</i>, <u>underline</u>, lists, and downloading.</p>`;

    panel.appendChild(doc);
    content.appendChild(toolbar);
    content.appendChild(panel);

    // handlers
    toolbar.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const cmd = btn.dataset.cmd;
      const act = btn.dataset.act;
      doc.focus();
      if (cmd){
        if (cmd === "insertUL") document.execCommand("insertUnorderedList");
        else if (cmd === "insertOL") document.execCommand("insertOrderedList");
        else document.execCommand(cmd);
        persist();
      }
      if (act === "save"){ persist(true); }
      if (act === "load"){
        const saved = localStorage.getItem("win11mock.word");
        if (saved != null) doc.innerHTML = saved;
      }
      if (act === "download"){
        const blob = new Blob([`<!doctype html><meta charset="utf-8"><title>${escapeHtml(name)}</title>${doc.outerHTML}`], {type:"text/html"});
        downloadBlob(blob, `${safeFileName(name)}.html`);
      }
    });

    const persist = (notify=false) => {
      localStorage.setItem("win11mock.word", doc.innerHTML);
      if (notify) toast("Word: saved to localStorage");
    };
    doc.addEventListener("input", () => persist(false));

    const win = makeWindow({appId:"word", title:`Word — ${name}`, contentEl: content, width: 920, height: 620});
    return win;
  }

  function openNotepad({name="Untitled", text=null} = {}){
    const content = document.createElement("div");
    content.style.height = "100%";
    content.style.display = "flex";
    content.style.flexDirection = "column";

    const toolbar = document.createElement("div");
    toolbar.className = "toolbar";
    toolbar.innerHTML = `
      <button class="toolbtn primary" data-act="save">Save</button>
      <button class="toolbtn" data-act="load">Load</button>
      <button class="toolbtn" data-act="download">Download .txt</button>
      <span class="split"></span>
      <input class="toolinput" data-act="filename" style="width:240px" value="${escapeHtml(name)}" />
      <span style="font-size:12px;color:rgba(255,255,255,.7)">localStorage</span>
    `;

    const ta = document.createElement("textarea");
    ta.className = "notepad";
    ta.value = text ?? (localStorage.getItem("win11mock.notepad") ?? "");

    content.appendChild(toolbar);
    content.appendChild(ta);

    const persist = () => localStorage.setItem("win11mock.notepad", ta.value);

    toolbar.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const act = btn.dataset.act;
      if (act === "save"){
        persist();
        toast("Notepad: saved to localStorage");
      } else if (act === "load"){
        ta.value = localStorage.getItem("win11mock.notepad") ?? "";
      } else if (act === "download"){
        const filename = toolbar.querySelector('[data-act="filename"]').value || "Untitled";
        const blob = new Blob([ta.value], {type:"text/plain;charset=utf-8"});
        downloadBlob(blob, `${safeFileName(filename)}.txt`);
      }
    });
    ta.addEventListener("input", persist);

    const win = makeWindow({appId:"notepad", title:`Notepad — ${name}`, contentEl: content, width: 760, height: 520});
    return win;
  }

  function openPaint(){
    const content = document.createElement("div");
    content.className = "paint-wrap";

    const toolbar = document.createElement("div");
    toolbar.className = "toolbar";
    toolbar.innerHTML = `
      <label class="toolbtn" style="gap:10px; cursor:default">
        Color <input type="color" class="toolinput" data-act="color" value="#111111" style="width:50px;padding:0 2px" />
      </label>
      <label class="toolbtn" style="gap:10px; cursor:default">
        Size <input type="range" data-act="size" min="1" max="40" value="6" />
      </label>
      <button class="toolbtn" data-act="eraser">Eraser</button>
      <button class="toolbtn danger" data-act="clear">Clear</button>
      <button class="toolbtn primary" data-act="download">Download PNG</button>
      <span class="split"></span>
      <span style="font-size:12px;color:rgba(255,255,255,.7)">Drag to draw</span>
    `;

    const wrap = document.createElement("div");
    wrap.className = "paint-canvas-wrap";
    const canvas = document.createElement("canvas");
    canvas.id = "paintCanvas";
    canvas.width = 980;
    canvas.height = 560;
    canvas.style.width = "min(980px, 92vw)";
    canvas.style.height = "auto";
    wrap.appendChild(canvas);

    content.appendChild(toolbar);
    content.appendChild(wrap);

    const ctx = canvas.getContext("2d");
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    let drawing = false;
    let color = "#111111";
    let size = 6;
    let erasing = false;

    function posFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left) * (canvas.width / rect.width);
      const y = (e.clientY - rect.top) * (canvas.height / rect.height);
      return {x, y};
    }

    function drawDot(x,y){
      ctx.beginPath();
      ctx.arc(x, y, size/2, 0, Math.PI*2);
      ctx.fillStyle = erasing ? "#ffffff" : color;
      ctx.fill();
    }

    let last = null;
    function drawLine(a,b){
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.lineWidth = size;
      ctx.lineCap = "round";
      ctx.strokeStyle = erasing ? "#ffffff" : color;
      ctx.stroke();
    }

    canvas.addEventListener("pointerdown", (e) => {
      canvas.setPointerCapture(e.pointerId);
      drawing = true;
      last = posFromEvent(e);
      drawDot(last.x, last.y);
    });
    canvas.addEventListener("pointermove", (e) => {
      if (!drawing) return;
      const p = posFromEvent(e);
      if (last) drawLine(last, p);
      last = p;
    });
    window.addEventListener("pointerup", () => { drawing = false; last = null; });

    toolbar.addEventListener("input", (e) => {
      const t = e.target;
      if (t.dataset.act === "color"){ color = t.value; erasing = false; }
      if (t.dataset.act === "size"){ size = Number(t.value) || 6; }
    });
    toolbar.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const act = btn.dataset.act;
      if (act === "eraser"){ erasing = !erasing; }
      if (act === "clear"){
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0,0,canvas.width,canvas.height);
      }
      if (act === "download"){
        canvas.toBlob((blob) => {
          if (!blob) return;
          downloadBlob(blob, "painting.png");
        }, "image/png");
      }
    });

    const win = makeWindow({appId:"paint", title:"Paint", contentEl: content, width: 980, height: 680});
    return win;
  }

  function openCalculator(){
    const content = document.createElement("div");
    content.className = "calc";

    const display = document.createElement("div");
    display.className = "calc-display";
    display.innerHTML = `<div class="expr" id="calcExpr"></div><div class="val" id="calcVal">0</div>`;

    const grid = document.createElement("div");
    grid.className = "calc-grid";

    const buttons = [
      {t:"C", cls:"danger"}, {t:"(", cls:"op"}, {t:")", cls:"op"}, {t:"⌫", cls:"op"},
      {t:"7"}, {t:"8"}, {t:"9"}, {t:"÷", cls:"op"},
      {t:"4"}, {t:"5"}, {t:"6"}, {t:"×", cls:"op"},
      {t:"1"}, {t:"2"}, {t:"3"}, {t:"−", cls:"op"},
      {t:"0"}, {t:"."}, {t:"%", cls:"op"}, {t:"+", cls:"op"},
      {t:"=", cls:"eq", span: 4}
    ];

    buttons.forEach(b => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "calc-btn " + (b.cls || "");
      btn.textContent = b.t;
      if (b.span) btn.style.gridColumn = `span ${b.span}`;
      grid.appendChild(btn);
    });

    content.appendChild(display);
    content.appendChild(grid);

    let expr = "";
    let lastVal = "0";
    const exprEl = () => display.querySelector("#calcExpr");
    const valEl = () => display.querySelector("#calcVal");

    function render(){
      exprEl().textContent = expr;
      valEl().textContent = lastVal;
    }

    function normalize(s){
      return s
        .replaceAll("÷","/")
        .replaceAll("×","*")
        .replaceAll("−","-");
    }

    function safeEval(expression){
      // Shunting-yard for + - * / % and parentheses
      const s = normalize(expression).replace(/\s+/g,"");
      if (!s) return 0;

      // Tokenize numbers/operators/parens
      const tokens = [];
      let i = 0;
      while (i < s.length){
        const ch = s[i];
        if (/\d|\./.test(ch)){
          let j = i+1;
          while (j < s.length && /[\d.]/.test(s[j])) j++;
          const num = s.slice(i,j);
          if (!/^\d*\.?\d+$/.test(num)) throw new Error("Bad number");
          tokens.push({type:"num", v: Number(num)});
          i = j;
        } else if ("+-*/%()".includes(ch)){
          // unary minus handling: if "-" at start or after operator/(
          if (ch === "-" && (tokens.length === 0 || (tokens[tokens.length-1].type !== "num" && tokens[tokens.length-1].v !== ")"))){
            tokens.push({type:"op", v:"u-"}); // unary minus
          } else {
            tokens.push({type:"op", v: ch});
          }
          i++;
        } else {
          throw new Error("Invalid char");
        }
      }

      const prec = {"u-":4, "*":3, "/":3, "%":3, "+":2, "-":2};
      const rightAssoc = {"u-": true};

      const out = [];
      const ops = [];

      for (const tok of tokens){
        if (tok.type === "num"){
          out.push(tok);
        } else {
          const op = tok.v;
          if (op === "("){
            ops.push(op);
          } else if (op === ")"){
            while (ops.length && ops[ops.length-1] !== "(") out.push({type:"op", v: ops.pop()});
            if (ops.pop() !== "(") throw new Error("Mismatched parens");
          } else {
            while (ops.length){
              const top = ops[ops.length-1];
              if (top === "(") break;
              const pTop = prec[top], pOp = prec[op];
              if (pTop > pOp || (pTop === pOp && !rightAssoc[op])){
                out.push({type:"op", v: ops.pop()});
              } else break;
            }
            ops.push(op);
          }
        }
      }
      while (ops.length){
        const op = ops.pop();
        if (op === "(") throw new Error("Mismatched parens");
        out.push({type:"op", v: op});
      }

      const stack = [];
      for (const tok of out){
        if (tok.type === "num"){
          stack.push(tok.v);
        } else {
          const op = tok.v;
          if (op === "u-"){
            if (stack.length < 1) throw new Error("Bad expr");
            stack.push(-stack.pop());
          } else {
            if (stack.length < 2) throw new Error("Bad expr");
            const b = stack.pop();
            const a = stack.pop();
            let r;
            if (op === "+") r = a + b;
            else if (op === "-") r = a - b;
            else if (op === "*") r = a * b;
            else if (op === "/") r = a / b;
            else if (op === "%") r = a % b;
            else throw new Error("Unknown op");
            stack.push(r);
          }
        }
      }
      if (stack.length !== 1 || !Number.isFinite(stack[0])) throw new Error("Bad result");
      return stack[0];
    }

    function press(t){
      if (t === "C"){
        expr = ""; lastVal = "0"; render(); return;
      }
      if (t === "⌫"){
        expr = expr.slice(0, -1);
        render();
        return;
      }
      if (t === "="){
        try{
          const v = safeEval(expr);
          lastVal = String(roundNice(v));
        }catch{
          lastVal = "Error";
        }
        render();
        return;
      }
      expr += t;
      // live preview
      try{
        const v = safeEval(expr);
        lastVal = String(roundNice(v));
      }catch{
        // keep lastVal as-is while typing invalid partial expression
      }
      render();
    }

    function roundNice(n){
      // Avoid floating noise for simple decimals
      const s = String(n);
      if (s.includes("e")) return n;
      return Math.round(n * 1e12) / 1e12;
    }

    grid.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      press(btn.textContent);
    });

    // keyboard
    window.addEventListener("keydown", (e) => {
      // Only when calculator is focused
      const focused = document.querySelector(".window.focused")?.dataset.app;
      if (focused !== "calc") return;

      const k = e.key;
      if (k === "Enter"){ press("="); e.preventDefault(); return; }
      if (k === "Backspace"){ press("⌫"); e.preventDefault(); return; }
      if (k === "Escape"){ press("C"); e.preventDefault(); return; }
      const map = {"*":"×", "/":"÷", "-":"−", "+":"+"};
      if (/\d/.test(k) || k === "." || k === "(" || k === ")" || k === "%"){
        press(k); e.preventDefault(); return;
      }
      if (map[k]){
        press(map[k]); e.preventDefault(); return;
      }
    });

    render();
    const win = makeWindow({appId:"calc", title:"Calculator", contentEl: content, width: 360, height: 560});
    return win;
  }

  function openExplorer(){
    const content = document.createElement("div");
    content.style.height = "100%";
    content.style.display = "flex";
    content.style.flexDirection = "column";

    // Fake filesystem
    const fs = {
      "Desktop": [
        {type:"txt", name:"Readme.txt", desc:"Notes about this demo", content:
`This is a standalone HTML “Windows 11-style” desktop mock.

- Icons open apps.
- Explorer opens files.
- Notepad/Word autosave to localStorage.
- Paint exports PNG.
- Chrome is an offline mini-browser with internal pages.`
        },
        {type:"doc", name:"Welcome.doc.html", desc:"A simple formatted doc", content:
`<h2 style="margin:0 0 10px">Welcome</h2>
<p>This is a lightweight, self-contained “Word-like” document.</p>
<ul><li>Edit text</li><li>Use formatting buttons</li><li>Download as .html</li></ul>`
        }
      ],
      "Documents": [
        {type:"txt", name:"Todo.txt", desc:"A few tasks", content:"- Try Paint\n- Try Calculator\n- Open internal pages in Chrome\n"}
      ],
      "Pictures": [
        {type:"png", name:"Sample.png", desc:"A generated sample image", content: makeSamplePngDataUrl()}
      ]
    };

    let current = "Desktop";

    const explorer = document.createElement("div");
    explorer.className = "explorer";

    const sidebar = document.createElement("div");
    sidebar.className = "sidebar";

    const places = Object.keys(fs);
    places.forEach(p => {
      const item = document.createElement("div");
      item.className = "side-item" + (p === current ? " active" : "");
      item.dataset.place = p;
      item.innerHTML = `<span style="width:16px;height:16px;display:inline-block;border-radius:5px;background:rgba(255,255,255,.18)"></span>
                        <span>${escapeHtml(p)}</span>`;
      sidebar.appendChild(item);
    });

    const right = document.createElement("div");
    right.style.display = "flex";
    right.style.flexDirection = "column";
    right.style.minWidth = "0";

    const path = document.createElement("div");
    path.className = "path";
    path.innerHTML = `
      <button class="toolbtn" data-act="up">Up</button>
      <input class="toolinput" value="${escapeHtml(current)}" aria-label="Path" />
      <span style="font-size:12px;color:rgba(255,255,255,.7)">Double-click to open</span>
    `;

    const files = document.createElement("div");
    files.className = "files";
    const grid = document.createElement("div");
    grid.className = "file-grid";
    files.appendChild(grid);

    right.appendChild(path);
    right.appendChild(files);

    explorer.appendChild(sidebar);
    explorer.appendChild(right);

    function fileIcon(type){
      if (type === "txt") return icons.notepad;
      if (type === "doc") return icons.word;
      if (type === "png") return icons.paint;
      return `<span class="ico small">?</span>`;
    }

    function render(){
      sidebar.querySelectorAll(".side-item").forEach(el => el.classList.toggle("active", el.dataset.place === current));
      path.querySelector("input").value = current;
      grid.innerHTML = "";
      fs[current].forEach((f, idx) => {
        const el = document.createElement("div");
        el.className = "file";
        el.dataset.idx = String(idx);
        el.innerHTML = `
          <div>${fileIcon(f.type)}</div>
          <div class="meta">
            <div class="name">${escapeHtml(f.name)}</div>
            <div class="desc">${escapeHtml(f.desc || "")}</div>
          </div>
        `;
        grid.appendChild(el);
      });
    }

    sidebar.addEventListener("click", (e) => {
      const item = e.target.closest(".side-item");
      if (!item) return;
      current = item.dataset.place;
      render();
    });

    let lastClick = {idx: null, t: 0};
    grid.addEventListener("click", (e) => {
      const item = e.target.closest(".file");
      if (!item) return;
      const idx = Number(item.dataset.idx);
      const now = performance.now();
      const isDouble = lastClick.idx === idx && (now - lastClick.t) < 420;
      lastClick = {idx, t: now};
      if (!isDouble) return;

      const f = fs[current][idx];
      if (f.type === "txt"){
        fileBus.openTextInNotepad(f.name, f.content);
      } else if (f.type === "doc"){
        fileBus.openTextInWord(f.name, f.content);
      } else if (f.type === "png"){
        // Open paint and load image onto canvas
        const win = openPaint();
        focusWindow(win);
        const canvas = win.querySelector("#paintCanvas");
        const ctx = canvas.getContext("2d");
        const img = new Image();
        img.onload = () => {
          ctx.fillStyle = "#fff";
          ctx.fillRect(0,0,canvas.width,canvas.height);
          const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
          const w = img.width * scale, h = img.height * scale;
          ctx.drawImage(img, (canvas.width-w)/2, (canvas.height-h)/2, w, h);
        };
        img.src = f.content;
      } else {
        toast("Explorer: can't open this file type.");
      }
    });

    content.appendChild(explorer);

    render();
    const win = makeWindow({appId:"explorer", title:"File Explorer", contentEl: content, width: 980, height: 640});
    return win;
  }

  function openChrome(){
    const content = document.createElement("div");
    content.className = "chrome";

    const omnibox = document.createElement("div");
    omnibox.className = "omnibox";
    omnibox.innerHTML = `
      <button class="toolbtn" data-act="back">Back</button>
      <button class="toolbtn" data-act="home">Home</button>
      <input class="toolinput" data-act="url" placeholder="Type a page name (home, docs, about) or a URL to open externally" />
      <button class="toolbtn primary" data-act="go">Go</button>
      <button class="toolbtn" data-act="external">Open externally</button>
    `;

    const webview = document.createElement("div");
    webview.className = "webview";
    const page = document.createElement("div");
    page.className = "page";
    webview.appendChild(page);

    content.appendChild(omnibox);
    content.appendChild(webview);

    const history = [];
    let idx = -1;

    const pages = {
      home: () => `
        <h1>New tab</h1>
        <p>This “Chrome” is an offline mini-browser inside the standalone HTML file.</p>
        <p>Use the chips below to navigate to internal pages, or use “Open externally” to open real websites in your actual browser.</p>
        <div class="chips">
          <div class="chip" data-nav="docs">docs</div>
          <div class="chip" data-nav="about">about</div>
          <div class="chip" data-nav="tips">tips</div>
        </div>
      `,
      docs: () => `
        <h1>Docs</h1>
        <p><b>Word</b>: rich text via contenteditable, autosaves to localStorage, downloads .html.</p>
        <p><b>Notepad</b>: plain text, autosaves to localStorage, downloads .txt.</p>
        <p><b>Paint</b>: draw on canvas, export PNG.</p>
        <p><b>Calculator</b>: safe parser (no eval), supports parentheses and %.</p>
        <p><b>Explorer</b>: fake folders and files, opens in other apps.</p>
      `,
      about: () => `
        <h1>About</h1>
        <p>This is a Windows 11-style desktop mock built with HTML/CSS/JS only.</p>
        <p>It intentionally does not embed Microsoft’s copyrighted wallpaper or official app icons. You can swap in your own assets if you have the rights.</p>
      `,
      tips: () => `
        <h1>Tips</h1>
        <p>Try:</p>
        <ul>
          <li>Open Explorer → Desktop → Readme.txt</li>
          <li>Draw something in Paint → Download PNG</li>
          <li>Type <code>(2+3)*4</code> into Calculator</li>
        </ul>
      `
    };

    function setPage(key){
      const html = pages[key] ? pages[key]() : `
        <h1>Page not found</h1>
        <p>No internal page named <b>${escapeHtml(key)}</b>.</p>
        <p>Use <b>Open externally</b> for real URLs.</p>
      `;
      page.innerHTML = html;
      const urlInput = omnibox.querySelector('[data-act="url"]');
      urlInput.value = key;
    }

    function nav(key){
      // Trim forward history
      history.splice(idx + 1);
      history.push(key);
      idx = history.length - 1;
      setPage(key);
    }

    omnibox.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      const chip = e.target.closest(".chip");
      if (chip){
        nav(chip.dataset.nav);
        return;
      }
      if (!btn) return;
      const act = btn.dataset.act;
      const urlInput = omnibox.querySelector('[data-act="url"]');
      const value = (urlInput.value || "").trim();

      if (act === "home"){
        nav("home");
      } else if (act === "back"){
        if (idx > 0){
          idx -= 1;
          setPage(history[idx]);
        }
      } else if (act === "go"){
        if (!value) { nav("home"); return; }
        // internal page if matches known keys
        nav(value.toLowerCase());
      } else if (act === "external"){
        // open real URL/search in actual browser tab/window
        const v = value || "https://example.com";
        const isUrl = /^https?:\/\//i.test(v);
        const target = isUrl ? v : `https://duckduckgo.com/?q=${encodeURIComponent(v)}`;
        window.open(target, "_blank", "noopener,noreferrer");
      }
    });

    // enter to go
    omnibox.querySelector('[data-act="url"]').addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        omnibox.querySelector('[data-act="go"]').click();
      }
    });

    nav("home");
    const win = makeWindow({appId:"chrome", title:"Chrome", contentEl: content, width: 980, height: 640});
    return win;
  }

  /* ----------------------------
     Utilities
  -----------------------------*/
  function downloadBlob(blob, filename){
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 1000);
  }

  function safeFileName(name){
    return String(name).replace(/[\\/:*?"<>|]+/g, "_").replace(/\s+/g," ").trim() || "file";
  }

  function toast(msg){
    const el = document.createElement("div");
    el.textContent = msg;
    el.style.position = "fixed";
    el.style.left = "50%";
    el.style.bottom = "80px";
    el.style.transform = "translateX(-50%)";
    el.style.padding = "10px 12px";
    el.style.borderRadius = "12px";
    el.style.background = "rgba(20,22,30,.72)";
    el.style.border = "1px solid rgba(255,255,255,.14)";
    el.style.backdropFilter = "blur(14px)";
    el.style.boxShadow = "0 14px 45px rgba(0,0,0,.35)";
    el.style.color = "rgba(255,255,255,.9)";
    el.style.fontSize = "13px";
    el.style.zIndex = "99999";
    el.style.maxWidth = "80vw";
    el.style.textAlign = "center";
    document.body.appendChild(el);
    setTimeout(() => { el.style.opacity = "0"; el.style.transition = "opacity .25s"; }, 1200);
    setTimeout(() => el.remove(), 1550);
  }

  function makeSamplePngDataUrl(){
    // Generate a small PNG-like data via canvas
    const c = document.createElement("canvas");
    c.width = 600; c.height = 360;
    const g = c.getContext("2d");
    const grd = g.createLinearGradient(0,0,600,360);
    grd.addColorStop(0, "#4fd0ff");
    grd.addColorStop(.6, "#2e78ff");
    grd.addColorStop(1, "#1c2bff");
    g.fillStyle = grd;
    g.fillRect(0,0,c.width,c.height);
    g.fillStyle = "rgba(255,255,255,.18)";
    g.beginPath(); g.arc(210,170,120,0,Math.PI*2); g.fill();
    g.fillStyle = "rgba(0,0,0,.22)";
    g.font = "700 26px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    g.fillText("Sample Image", 200, 190);
    return c.toDataURL("image/png");
  }

  /* ----------------------------
     Desktop icon wiring
  -----------------------------*/
  function openApp(appId){
    if (appId === "word") return openWord();
    if (appId === "paint") return openPaint();
    if (appId === "calc") return openCalculator();
    if (appId === "notepad") return openNotepad();
    if (appId === "explorer") return openExplorer();
    if (appId === "chrome") return openChrome();
  }

  document.getElementById("iconGrid").addEventListener("dblclick", (e) => {
    const icon = e.target.closest(".desktop-icon");
    if (!icon) return;
    openApp(icon.dataset.app);
  });

  document.getElementById("iconGrid").addEventListener("keydown", (e) => {
    if (e.key !== "Enter") return;
    const icon = e.target.closest(".desktop-icon");
    if (!icon) return;
    openApp(icon.dataset.app);
  });

  // Convenience: single click selects (visual could be added; kept minimal)
  document.getElementById("iconGrid").addEventListener("click", (e) => {
    const icon = e.target.closest(".desktop-icon");
    if (!icon) return;
    // open on single click if you want:
    // openApp(icon.dataset.app);
  });

  // Open a couple of apps by default (feel free to remove)
  openExplorer();
  openChrome();

})();
</script>
</body>
</html>