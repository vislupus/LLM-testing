<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Windows 11 Desktop Clone (Single HTML)</title>
  <style>
    :root {
      --taskbar-height: 52px;
      --window-border-radius: 10px;
      --window-bg: #f3f3f3;
      --window-title-bg: #e5e5e5;
      --window-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.16);
      --text: #111827;
      --text-soft: #6b7280;
      --desktop-icon-size: 68px;
      --taskbar-bg: rgba(24, 24, 27, 0.84);
      --taskbar-border: rgba(148, 163, 184, 0.35);
      --taskbar-radius: 16px;
      --border-subtle: #d4d4d8;
      --button-bg: #e4e4e7;
      --button-bg-hover: #d4d4d8;
    }

    * {
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
    }

    body {
      /* === "Wallpaper" ===
         Replace this with your own image if you want the *actual* Windows 11 wallpaper:
         e.g. background: url('my-win11-wallpaper.jpg') center/cover no-repeat fixed;
      */
      background:
        radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.25), transparent 55%),
        radial-gradient(circle at 80% 80%, rgba(0, 0, 0, 0.6), transparent 55%),
        radial-gradient(circle at 85% 0%, #4f9dfb, #003a88 65%);
      background-color: #0b4fd8;
    }

    .desktop {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    /* === Desktop icons === */
    .desktop-icons {
      position: absolute;
      top: 16px;
      left: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-bottom: 80px;
      z-index: 1;
    }

    .icon {
      width: 96px;
      cursor: default;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
      font-size: 12px;
    }

    .icon-image {
      width: var(--desktop-icon-size);
      height: var(--desktop-icon-size);
      border-radius: 18%;
      background: rgba(15, 23, 42, 0.72);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.65);
      font-weight: 600;
      font-size: 28px;
    }

    .icon-word  .icon-image { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
    .icon-paint .icon-image { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .icon-calc  .icon-image { background: linear-gradient(135deg, #0ea5e9, #0369a1); }
    .icon-note  .icon-image { background: linear-gradient(135deg, #f97316, #ea580c); }
    .icon-files .icon-image { background: linear-gradient(135deg, #facc15, #eab308); }
    .icon-chrome .icon-image { background: conic-gradient(#ef4444, #facc15, #22c55e, #3b82f6, #ef4444); }

    .icon-image span {
      display: inline-block;
      transform: translateY(2px);
    }

    .icon-label {
      text-align: center;
      line-height: 1.2;
    }

    .icon:active .icon-image {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.65);
    }

    /* === Taskbar === */
    .taskbar-wrap {
      position: absolute;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: center;
      pointer-events: none;
      z-index: 10;
    }

    .taskbar {
      width: min(720px, 92vw);
      height: var(--taskbar-height);
      background: var(--taskbar-bg);
      border-radius: var(--taskbar-radius);
      border: 1px solid var(--taskbar-border);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 14px;
      pointer-events: auto;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      color: #e5e7eb;
      font-size: 11px;
    }

    .taskbar-center {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      justify-content: center;
    }

    .taskbar-left {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .taskbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 120px;
      justify-content: flex-end;
    }

    .start-btn, .taskbar-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
    }

    .start-btn:hover,
    .taskbar-icon:hover {
      background: rgba(148, 163, 184, 0.2);
    }

    .start-logo {
      width: 18px;
      height: 18px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 1px;
    }

    .start-logo span {
      display: block;
      background: #f9fafb;
    }

    .taskbar-icon-dot {
      width: 3px;
      height: 3px;
      border-radius: 999px;
      background: #e5e7eb;
      margin-top: 2px;
    }

    .taskbar-clock {
      text-align: right;
      line-height: 1.2;
    }

    /* === Windows === */
    .window {
      position: absolute;
      top: 120px;
      left: 180px;
      width: min(720px, 70vw);
      height: min(480px, 60vh);
      background: var(--window-bg);
      border-radius: var(--window-border-radius);
      box-shadow: var(--window-shadow);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: none;
      flex-direction: column;
      overflow: hidden;
    }

    .window.active {
      border-color: var(--accent);
    }

    .window-titlebar {
      height: 36px;
      background: var(--window-title-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      cursor: move;
    }

    .window-title-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .window-title-icon {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      background: var(--accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: var(--accent);
      font-weight: 600;
    }

    .window-title {
      font-size: 13px;
      color: #111827;
    }

    .window-controls {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .window-btn {
      width: 34px;
      height: 26px;
      border-radius: 4px;
      border: none;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      color: #111827;
    }

    .window-btn:hover {
      background: rgba(148, 163, 184, 0.25);
    }

    .window-btn.close:hover {
      background: #ef4444;
      color: #f9fafb;
    }

    .window-body {
      flex: 1;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .window-body-scroll {
      flex: 1;
      overflow: auto;
      padding-right: 2px;
    }

    /* === Word (rich text editor) === */
    .word-toolbar {
      display: flex;
      gap: 4px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .toolbar-btn {
      font-size: 12px;
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
      background: var(--button-bg);
      padding: 4px 7px;
      cursor: pointer;
    }

    .toolbar-btn:hover {
      background: var(--button-bg-hover);
    }

    .word-editor {
      flex: 1;
      background: white;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      padding: 8px 10px;
      overflow: auto;
      font-size: 14px;
      line-height: 1.3;
      -webkit-user-select: text;
      user-select: text;
    }

    /* === Notepad === */
    .notepad-editor {
      flex: 1;
      width: 100%;
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
      resize: none;
      padding: 8px 10px;
      font-family: "Consolas", "Courier New", monospace;
      font-size: 13px;
      -webkit-user-select: text;
      user-select: text;
    }

    /* === Calculator === */
    .calc-container {
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 8px;
      height: 100%;
    }

    .calc-display {
      background: #111827;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 8px 10px;
      text-align: right;
      font-size: 20px;
      min-height: 40px;
      overflow: hidden;
      white-space: nowrap;
    }

    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: 44px;
      gap: 6px;
    }

    .calc-btn {
      border-radius: 8px;
      border: none;
      background: #e5e7eb;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .calc-btn.op {
      background: #d4d4d8;
    }

    .calc-btn.eq {
      background: var(--accent);
      color: #f9fafb;
    }

    .calc-btn:active {
      transform: translateY(1px) scale(0.99);
    }

    /* === Paint === */
    .paint-toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .paint-toolbar input[type="color"] {
      width: 32px;
      height: 24px;
      padding: 0;
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
      background: white;
    }

    .paint-size-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: var(--button-bg);
      padding: 2px 8px;
      font-size: 11px;
      cursor: pointer;
    }

    .paint-size-btn.active {
      background: var(--accent);
      color: #f9fafb;
      border-color: var(--accent);
    }

    #paint-canvas {
      flex: 1;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: white;
      cursor: crosshair;
    }

    /* === File Explorer === */
    .explorer-layout {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 8px;
      height: 100%;
    }

    .explorer-sidebar {
      background: #f4f4f5;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      padding: 6px 8px;
      font-size: 13px;
      overflow: auto;
    }

    .explorer-main {
      background: white;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      padding: 8px 10px;
      overflow: auto;
      font-size: 13px;
    }

    .file-tree {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .file-tree li {
      margin: 2px 0;
    }

    .file-tree span {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .file-tree .folder > span::before {
      content: "‚ñ∏";
      display: inline-block;
      margin-right: 2px;
      font-size: 9px;
    }

    .file-tree .folder.expanded > span::before {
      content: "‚ñæ";
    }

    .file-tree ul {
      list-style: none;
      padding-left: 16px;
      margin: 2px 0;
      display: none;
    }

    .file-tree .folder.expanded > ul {
      display: block;
    }

    .file {
      padding-left: 12px;
    }

    .file::before {
      content: "üìÑ";
      margin-right: 4px;
    }

    /* === Browser (Chrome-like) === */
    .browser-toolbar {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
      align-items: center;
    }

    .browser-url {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 4px 10px;
      font-size: 13px;
      background: #f4f4f5;
      -webkit-user-select: text;
      user-select: text;
    }

    .browser-go {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: var(--button-bg);
      padding: 4px 10px;
      font-size: 13px;
      cursor: pointer;
    }

    .browser-go:hover {
      background: var(--button-bg-hover);
    }

    .browser-frame {
      flex: 1;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: white;
      width: 100%;
    }

    .browser-note {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* Scrollbars (subtle) */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }

    @media (max-width: 768px) {
      .window {
        width: 94vw;
        height: 70vh;
        left: 3%;
      }

      .explorer-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="desktop">
    <!-- === Desktop Icons === -->
    <div class="desktop-icons">
      <div class="icon icon-word" data-app="word">
        <div class="icon-image">
          <span>W</span>
        </div>
        <div class="icon-label">Word</div>
      </div>

      <div class="icon icon-paint" data-app="paint">
        <div class="icon-image">
          <span>üé®</span>
        </div>
        <div class="icon-label">Paint</div>
      </div>

      <div class="icon icon-calc" data-app="calc">
        <div class="icon-image">
          <span>‚â°</span>
        </div>
        <div class="icon-label">Calculator</div>
      </div>

      <div class="icon icon-note" data-app="notepad">
        <div class="icon-image">
          <span>üìù</span>
        </div>
        <div class="icon-label">Notepad</div>
      </div>

      <div class="icon icon-files" data-app="explorer">
        <div class="icon-image">
          <span>üìÅ</span>
        </div>
        <div class="icon-label">File Explorer</div>
      </div>

      <div class="icon icon-chrome" data-app="chrome">
        <div class="icon-image">
          <span>üåê</span>
        </div>
        <div class="icon-label">Chrome</div>
      </div>
    </div>

    <!-- === Windows / Apps === -->

    <!-- Word -->
    <div class="window" id="word-window" data-app-window="word">
      <div class="window-titlebar">
        <div class="window-title-left">
          <div class="window-title-icon">W</div>
          <div class="window-title">Word</div>
        </div>
        <div class="window-controls">
          <button class="window-btn min" title="Minimize">‚Äî</button>
          <button class="window-btn max" title="Maximize">&#9633;</button>
          <button class="window-btn close" title="Close">‚úï</button>
        </div>
      </div>
      <div class="window-body">
        <div class="word-toolbar">
          <button class="toolbar-btn" data-cmd="bold"><b>B</b></button>
          <button class="toolbar-btn" data-cmd="italic"><i>I</i></button>
          <button class="toolbar-btn" data-cmd="underline"><u>U</u></button>
          <button class="toolbar-btn" data-cmd="insertUnorderedList">‚Ä¢ List</button>
          <button class="toolbar-btn" data-cmd="insertOrderedList">1. List</button>
          <button class="toolbar-btn" data-cmd="justifyLeft">Left</button>
          <button class="toolbar-btn" data-cmd="justifyCenter">Center</button>
          <button class="toolbar-btn" data-cmd="justifyRight">Right</button>
        </div>
        <div class="word-editor" id="word-editor" contenteditable="true">
          <p><b>Welcome to the fake Word!</b> Type and format text here.</p>
        </div>
      </div>
    </div>

    <!-- Notepad -->
    <div class="window" id="notepad-window" data-app-window="notepad" style="top: 140px; left: 260px; width: 420px; height: 320px;">
      <div class="window-titlebar">
        <div class="window-title-left">
          <div class="window-title-icon">N</div>
          <div class="window-title">Notepad</div>
        </div>
        <div class="window-controls">
          <button class="window-btn min" title="Minimize">‚Äî</button>
          <button class="window-btn max" title="Maximize">&#9633;</button>
          <button class="window-btn close" title="Close">‚úï</button>
        </div>
      </div>
      <div class="window-body">
        <textarea class="notepad-editor" id="notepad-editor" spellcheck="false">Simple Notepad. Type anything you like here.</textarea>
      </div>
    </div>

    <!-- Calculator -->
    <div class="window" id="calc-window" data-app-window="calc" style="top: 160px; left: 340px; width: 320px; height: 380px;">
      <div class="window-titlebar">
        <div class="window-title-left">
          <div class="window-title-icon">‚àë</div>
          <div class="window-title">Calculator</div>
        </div>
        <div class="window-controls">
          <button class="window-btn min" title="Minimize">‚Äî</button>
          <button class="window-btn max" title="Maximize">&#9633;</button>
          <button class="window-btn close" title="Close">‚úï</button>
        </div>
      </div>
      <div class="window-body">
        <div class="calc-container">
          <div class="calc-display" id="calc-display">0</div>
          <div class="calc-buttons" id="calc-buttons">
            <!-- Row 1 -->
            <button class="calc-btn op" data-action="clear">C</button>
            <button class="calc-btn op" data-val="(">(</button>
            <button class="calc-btn op" data-val=")">)</button>
            <button class="calc-btn op" data-val="/">√∑</button>
            <!-- Row 2 -->
            <button class="calc-btn" data-val="7">7</button>
            <button class="calc-btn" data-val="8">8</button>
            <button class="calc-btn" data-val="9">9</button>
            <button class="calc-btn op" data-val="*">√ó</button>
            <!-- Row 3 -->
            <button class="calc-btn" data-val="4">4</button>
            <button class="calc-btn" data-val="5">5</button>
            <button class="calc-btn" data-val="6">6</button>
            <button class="calc-btn op" data-val="-">‚àí</button>
            <!-- Row 4 -->
            <button class="calc-btn" data-val="1">1</button>
            <button class="calc-btn" data-val="2">2</button>
            <button class="calc-btn" data-val="3">3</button>
            <button class="calc-btn op" data-val="+">+</button>
            <!-- Row 5 -->
            <button class="calc-btn" data-action="back">‚å´</button>
            <button class="calc-btn" data-val="0">0</button>
            <button class="calc-btn" data-val=".">.</button>
            <button class="calc-btn eq" data-action="equals">=</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Paint -->
    <div class="window" id="paint-window" data-app-window="paint" style="top: 110px; left: 260px; width: 540px; height: 380px;">
      <div class="window-titlebar">
        <div class="window-title-left">
          <div class="window-title-icon">üé®</div>
          <div class="window-title">Paint</div>
        </div>
        <div class="window-controls">
          <button class="window-btn min" title="Minimize">‚Äî</button>
          <button class="window-btn max" title="Maximize">&#9633;</button>
          <button class="window-btn close" title="Close">‚úï</button>
        </div>
      </div>
      <div class="window-body">
        <div class="paint-toolbar">
          <span>Color:</span>
          <input type="color" id="paint-color" value="#2563eb">
          <span>Size:</span>
          <button class="paint-size-btn active" data-size="2">Thin</button>
          <button class="paint-size-btn" data-size="5">Medium</button>
          <button class="paint-size-btn" data-size="10">Thick</button>
          <button class="toolbar-btn" id="paint-clear">Clear</button>
        </div>
        <canvas id="paint-canvas"></canvas>
      </div>
    </div>

    <!-- File Explorer -->
    <div class="window" id="explorer-window" data-app-window="explorer" style="top: 90px; left: 200px; width: 640px; height: 420px;">
      <div class="window-titlebar">
        <div class="window-title-left">
          <div class="window-title-icon">üìÅ</div>
          <div class="window-title">File Explorer</div>
        </div>
        <div class="window-controls">
          <button class="window-btn min" title="Minimize">‚Äî</button>
          <button class="window-btn max" title="Maximize">&#9633;</button>
          <button class="window-btn close" title="Close">‚úï</button>
        </div>
      </div>
      <div class="window-body">
        <div class="explorer-layout">
          <div class="explorer-sidebar">
            <strong>Quick access</strong>
            <ul class="file-tree">
              <li class="folder expanded">
                <span>Documents</span>
                <ul>
                  <li class="file" data-open-app="word">Report.docx</li>
                  <li class="file" data-open-app="notepad">Notes.txt</li>
                </ul>
              </li>
              <li class="folder expanded">
                <span>Pictures</span>
                <ul>
                  <li class="file" data-open-app="paint">Drawing.png</li>
                </ul>
              </li>
              <li class="folder expanded">
                <span>Apps</span>
                <ul>
                  <li class="file" data-open-app="calc">Calculator.lnk</li>
                  <li class="file" data-open-app="chrome">Chrome.lnk</li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="explorer-main">
            <p><strong>Welcome to the fake File Explorer.</strong></p>
            <p>Click files on the left to open the corresponding apps. This is just a simple demo, so it doesn't show your real file system.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Chrome-like Browser -->
    <div class="window" id="chrome-window" data-app-window="chrome" style="top: 70px; left: 120px; width: 760px; height: 460px;">
      <div class="window-titlebar">
        <div class="window-title-left">
          <div class="window-title-icon">üåê</div>
          <div class="window-title">Chrome</div>
        </div>
        <div class="window-controls">
          <button class="window-btn min" title="Minimize">‚Äî</button>
          <button class="window-btn max" title="Maximize">&#9633;</button>
          <button class="window-btn close" title="Close">‚úï</button>
        </div>
      </div>
      <div class="window-body">
        <div class="browser-toolbar">
          <input type="text" class="browser-url" id="browser-url" value="https://www.bing.com">
          <button class="browser-go" id="browser-go">Go</button>
        </div>
        <iframe class="browser-frame" id="browser-frame" src="https://www.bing.com"></iframe>
        <p class="browser-note">
          This is a minimal embedded browser. Some sites may block being shown in an iframe.
        </p>
      </div>
    </div>

    <!-- === Taskbar === -->
    <div class="taskbar-wrap">
      <div class="taskbar">
        <div class="taskbar-left">
          <button class="start-btn" title="Start">
            <div class="start-logo">
              <span></span><span></span>
              <span></span><span></span>
            </div>
          </button>
        </div>
        <div class="taskbar-center">
          <button class="taskbar-icon" data-app="explorer" title="File Explorer">
            üìÅ
          </button>
          <button class="taskbar-icon" data-app="word" title="Word">
            W
          </button>
          <button class="taskbar-icon" data-app="notepad" title="Notepad">
            üìù
          </button>
          <button class="taskbar-icon" data-app="chrome" title="Chrome">
            üåê
          </button>
        </div>
        <div class="taskbar-right">
          <div class="taskbar-clock">
            <div id="clock-time">00:00</div>
            <div id="clock-date">--/--/----</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const windows = Array.from(document.querySelectorAll('.window'));
      const desktop = document.querySelector('.desktop');
      let zCounter = 50;

      function bringToFront(win) {
        zCounter += 1;
        win.style.zIndex = String(zCounter);
        windows.forEach(w => w.classList.remove('active'));
        win.classList.add('active');
      }

      function openApp(id) {
        const win = document.querySelector(`.window[data-app-window="${id}"]`);
        if (!win) return;
        win.style.display = 'flex';
        if (!win.style.left) {
          win.style.left = '15%';
          win.style.top = '12%';
        }
        bringToFront(win);
      }

      function closeWindow(win) {
        win.style.display = 'none';
        win.classList.remove('active');
      }

      function minimizeWindow(win) {
        win.style.display = 'none';
        win.classList.remove('active');
      }

      function toggleMaximize(win) {
        const isMax = win.dataset.maximized === 'true';
        if (!isMax) {
          win.dataset.prevLeft = win.style.left;
          win.dataset.prevTop = win.style.top;
          win.dataset.prevWidth = win.style.width;
          win.dataset.prevHeight = win.style.height;
          win.style.left = '4%';
          win.style.top = '4%';
          win.style.width = '92%';
          win.style.height = '82%';
          win.dataset.maximized = 'true';
        } else {
          win.style.left = win.dataset.prevLeft || '15%';
          win.style.top = win.dataset.prevTop || '12%';
          win.style.width = win.dataset.prevWidth || '70vw';
          win.style.height = win.dataset.prevHeight || '60vh';
          win.dataset.maximized = 'false';
        }
        bringToFront(win);
      }

      // Desktop icons double-click
      document.querySelectorAll('.icon').forEach(icon => {
        icon.addEventListener('dblclick', () => {
          const app = icon.dataset.app;
          openApp(app);
        });
      });

      // Taskbar icons
      document.querySelectorAll('.taskbar-icon').forEach(btn => {
        btn.addEventListener('click', () => {
          const app = btn.dataset.app;
          const win = document.querySelector(`.window[data-app-window="${app}"]`);
          if (win && win.style.display !== 'none' && win.style.display !== '') {
            // Already open: bring to front
            bringToFront(win);
          } else {
            openApp(app);
          }
        });
      });

      // Window titlebar controls + activation
      windows.forEach(win => {
        win.addEventListener('mousedown', () => bringToFront(win));
        const [btnMin, btnMax, btnClose] = win.querySelectorAll('.window-controls .window-btn');
        if (btnClose) btnClose.addEventListener('click', () => closeWindow(win));
        if (btnMin) btnMin.addEventListener('click', () => minimizeWindow(win));
        if (btnMax) btnMax.addEventListener('click', () => toggleMaximize(win));
      });

      // Dragging windows
      let dragInfo = null;

      function startDrag(e, win) {
        if (win.dataset.maximized === 'true') return; // don't drag maximized
        const rect = win.getBoundingClientRect();
        dragInfo = {
          win,
          offsetX: e.clientX - rect.left,
          offsetY: e.clientY - rect.top
        };
        bringToFront(win);
      }

      desktop.addEventListener('mousedown', e => {
        const titlebar = e.target.closest('.window-titlebar');
        if (!titlebar) return;
        const win = titlebar.parentElement;
        startDrag(e, win);
      });

      document.addEventListener('mousemove', e => {
        if (!dragInfo) return;
        const { win, offsetX, offsetY } = dragInfo;
        const dx = e.clientX - offsetX;
        const dy = e.clientY - offsetY;
        win.style.left = dx + 'px';
        win.style.top = dy + 'px';
      });

      document.addEventListener('mouseup', () => {
        dragInfo = null;
      });

      // === Clock ===
      function updateClock() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const d = String(now.getDate()).padStart(2, '0');
        const mo = String(now.getMonth() + 1).padStart(2, '0');
        const y = now.getFullYear();
        document.getElementById('clock-time').textContent = `${h}:${m}`;
        document.getElementById('clock-date').textContent = `${d}/${mo}/${y}`;
      }
      updateClock();
      setInterval(updateClock, 10_000);

      // === Word toolbar ===
      document.querySelectorAll('.word-toolbar .toolbar-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const cmd = btn.dataset.cmd;
          if (!cmd) return;
          document.execCommand(cmd, false, null);
        });
      });

      // === Calculator logic ===
      (function () {
        const display = document.getElementById('calc-display');
        const buttons = document.getElementById('calc-buttons');
        let expr = '';

        function render() {
          display.textContent = expr || '0';
        }

        function append(val) {
          expr += val;
          render();
        }

        function clearAll() {
          expr = '';
          render();
        }

        function backspace() {
          expr = expr.slice(0, -1);
          render();
        }

        function evaluate() {
          if (!expr) return;
          const safe = /^[0-9+\-*/.() ]+$/;
          if (!safe.test(expr)) {
            display.textContent = 'Error';
            expr = '';
            return;
          }
          try {
            // Evaluate expression safely
            const result = Function('"use strict";return (' + expr + ')')();
            expr = String(result);
            render();
          } catch {
            display.textContent = 'Error';
            expr = '';
          }
        }

        buttons.addEventListener('click', e => {
          const btn = e.target.closest('.calc-btn');
          if (!btn) return;
          const val = btn.dataset.val;
          const action = btn.dataset.action;
          if (action === 'clear') return clearAll();
          if (action === 'back') return backspace();
          if (action === 'equals') return evaluate();
          if (val != null) append(val);
        });
      })();

      // === Paint logic ===
      (function () {
        const canvas = document.getElementById('paint-canvas');
        if (!canvas.getContext) return;
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let lastX = 0;
        let lastY = 0;
        let brushSize = 2;
        let brushColor = document.getElementById('paint-color').value;

        function resizeCanvas() {
          const rect = canvas.parentElement.getBoundingClientRect();
          const ratio = window.devicePixelRatio || 1;
          canvas.width = (rect.width - 2) * ratio;
          canvas.height = (rect.height - 2) * ratio;
          ctx.scale(ratio, ratio);
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, rect.width, rect.height);
        }

        // Initialize
        setTimeout(resizeCanvas, 200);
        window.addEventListener('resize', () => {
          // naive clear & resize; no persistence
          resizeCanvas();
        });

        function getPos(e) {
          const rect = canvas.getBoundingClientRect();
          return {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
          };
        }

        function startDraw(e) {
          drawing = true;
          const pos = getPos(e);
          lastX = pos.x;
          lastY = pos.y;
        }

        function draw(e) {
          if (!drawing) return;
          const pos = getPos(e);
          ctx.strokeStyle = brushColor;
          ctx.lineWidth = brushSize;
          ctx.lineCap = 'round';
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(pos.x, pos.y);
          ctx.stroke();
          lastX = pos.x;
          lastY = pos.y;
        }

        function endDraw() {
          drawing = false;
        }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        document.addEventListener('mouseup', endDraw);

        document.getElementById('paint-color').addEventListener('input', e => {
          brushColor = e.target.value;
        });

        document.querySelectorAll('.paint-size-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.paint-size-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            brushSize = Number(btn.dataset.size) || 2;
          });
        });

        document.getElementById('paint-clear').addEventListener('click', () => {
          const rect = canvas.getBoundingClientRect();
          ctx.clearRect(0, 0, rect.width, rect.height);
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, rect.width, rect.height);
        });
      })();

      // === File Explorer tree behaviour ===
      document.querySelectorAll('.file-tree .folder > span').forEach(span => {
        span.addEventListener('click', () => {
          const li = span.parentElement;
          li.classList.toggle('expanded');
        });
      });

      document.querySelectorAll('.file-tree .file').forEach(file => {
        file.addEventListener('dblclick', () => {
          const app = file.dataset.openApp;
          if (app) openApp(app);
        });
      });

      // === Browser / Chrome-like ===
      (function () {
        const urlInput = document.getElementById('browser-url');
        const frame = document.getElementById('browser-frame');
        const goBtn = document.getElementById('browser-go');

        function normalizeUrl(url) {
          if (!url) return '';
          if (!/^https?:\/\//i.test(url)) {
            return 'https://' + url;
          }
          return url;
        }

        function navigate() {
          const url = normalizeUrl(urlInput.value.trim());
          if (url) {
            urlInput.value = url;
            frame.src = url;
          }
        }

        goBtn.addEventListener('click', navigate);
        urlInput.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            navigate();
          }
        });
      })();

      // === Initial state ===
      // Open File Explorer by default to show something
      openApp('explorer');
    })();
  </script>
</body>
</html>
