<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
    <script>
        let G = 100;
        let dt = 1;
        let bodies = [];
        let departed = false;

        class Body {
            constructor(x, y, vx, vy, m, r, col) {
                this.pos = createVector(x, y);
                this.vel = createVector(vx, vy);
                this.mass = m;
                this.radius = r;
                this.color = col;
                this.trail = [];
            }

            update() {
                let acc = createVector(0, 0);
                for (let other of bodies) {
                    if (other !== this) {
                        let d = p5.Vector.sub(other.pos, this.pos);
                        let dist = d.mag();
                        if (dist > 0.01) {
                            let f = G * this.mass * other.mass / (dist * dist);
                            acc.add(d.mult(f / this.mass / dist));
                        }
                    }
                }
                this.vel.add(acc.mult(dt));
                this.pos.add(this.vel.mult(dt));
            }

            draw() {
                fill(this.color);
                ellipse(this.pos.x, this.pos.y, this.radius * 2);
            }

            drawTrail() {
                stroke(this.color);
                strokeWeight(1);
                noFill();
                beginShape();
                for (let p of this.trail) {
                    vertex(p.x, p.y);
                }
                endShape();
            }

            pushTrail() {
                this.trail.push(this.pos.copy());
            }
        }

        function setup() {
            createCanvas(800, 800);
            let mSun = 100;
            let mEarth = 1;
            let mJup = 10;
            let rEarth = 200;
            let rJup = 300;
            let totalM = mSun + mEarth + mJup;
            let center = 400;
            let theta = 44 * Math.PI / 180;
            let relEarth = createVector(rEarth, 0);
            let relJup = createVector(rJup * Math.cos(theta), rJup * Math.sin(theta));
            let correction = p5.Vector.mult(relEarth, mEarth);
            correction.add(p5.Vector.mult(relJup, mJup));
            correction.div(totalM);
            let posSun = createVector(center, center);
            posSun.sub(correction);
            let posEarth = posSun.copy().add(relEarth);
            let posJup = posSun.copy().add(relJup);
            let vEarth = Math.sqrt(G * mSun / rEarth);
            let vJup = Math.sqrt(G * mSun / rJup);
            let unitTanE = createVector(-relEarth.y, relEarth.x).normalize();
            let velEarth = unitTanE.mult(vEarth);
            let unitTanJ = createVector(-relJup.y, relJup.x).normalize();
            let velJup = unitTanJ.mult(vJup);
            let velSun = createVector(0, 0);
            velSun.sub(p5.Vector.mult(velEarth, mEarth));
            velSun.sub(p5.Vector.mult(velJup, mJup));
            velSun.div(mSun);

            bodies.push(new Body(posSun.x, posSun.y, velSun.x, velSun.y, mSun, 20, color(255, 200, 0)));
            bodies.push(new Body(posEarth.x, posEarth.y, velEarth.x, velEarth.y, mEarth, 10, color(0, 100, 255)));
            bodies.push(new Body(posJup.x, posJup.y, velJup.x, velJup.y, mJup, 15, color(255, 140, 0)));

            let posSpace = posEarth.copy();
            posSpace.add(createVector(0, -15));
            let velSpace = velEarth.copy();
            bodies.push(new Body(posSpace.x, posSpace.y, velSpace.x, velSpace.y, 0.001, 5, color(0, 255, 0)));

            for (let b of bodies) {
                b.pushTrail();
            }
        }

        function draw() {
            background(220);

            if (frameCount === 60) {
                if (!departed) {
                    let deltaV = createVector(0, 0.68);
                    bodies[3].vel.add(deltaV);
                    departed = true;
                }
            }

            for (let b of bodies) {
                b.update();
            }

            for (let b of bodies) {
                b.pushTrail();
            }

            for (let b of bodies) {
                b.drawTrail();
            }

            noStroke();

            for (let b of bodies) {
                b.draw();
            }
        }
    </script>
</body>
</html>