<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Ray Traced Spheres</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babylon.js Core -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    <!-- Babylon.js Materials -->
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #1a1a1a; font-family: 'Segoe UI', sans-serif; }
        #renderCanvas { width: 100%; height: 100vh; touch-action: none; outline: none; }
        .glass-panel {
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        .slider-track {
            -webkit-appearance: none; width: 100%; background: transparent;
        }
        .slider-track::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #38bdf8; cursor: pointer; margin-top: -6px;
        }
        .slider-track::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px;
        }
    </style>
</head>
<body>

    <!-- UI Overlay -->
    <div class="absolute top-4 right-4 w-80 glass-panel rounded-xl p-6 text-gray-200 z-10 select-none">
        <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500 mb-1">Ray Traced Reflections</h1>
        <p class="text-xs text-gray-400 mb-5">Real-time PBR with SSR + Environment</p>

        <!-- Sphere 1 Controls -->
        <div class="mb-5 p-3 bg-white/5 rounded-lg border border-white/10">
            <div class="text-xs font-bold text-cyan-400 uppercase mb-3 flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-yellow-400"></div>
                Gold Sphere
            </div>
            
            <div class="space-y-3">
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span>Metallic</span>
                        <span id="val-met-0" class="text-cyan-400">1.0</span>
                    </div>
                    <input type="range" id="met-0" min="0" max="1" step="0.01" value="1" class="slider-track">
                </div>
                
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span>Roughness</span>
                        <span id="val-rough-0" class="text-cyan-400">0.15</span>
                    </div>
                    <input type="range" id="rough-0" min="0" max="1" step="0.01" value="0.15" class="slider-track">
                </div>
            </div>
        </div>

        <!-- Sphere 2 Controls -->
        <div class="mb-5 p-3 bg-white/5 rounded-lg border border-white/10">
            <div class="text-xs font-bold text-cyan-400 uppercase mb-3 flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                Silver Sphere
            </div>
            
            <div class="space-y-3">
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span>Metallic</span>
                        <span id="val-met-1" class="text-cyan-400">1.0</span>
                    </div>
                    <input type="range" id="met-1" min="0" max="1" step="0.01" value="1" class="slider-track">
                </div>
                
                <div>
                    <div class="flex justify-between text-xs mb-1">
                        <span>Roughness</span>
                        <span id="val-rough-1" class="text-cyan-400">0.08</span>
                    </div>
                    <input type="range" id="rough-1" min="0" max="1" step="0.01" value="0.08" class="slider-track">
                </div>
            </div>
        </div>

        <!-- Environment Controls -->
        <div class="space-y-3">
            <div>
                <div class="flex justify-between text-xs mb-1">
                    <span>Environment Intensity</span>
                    <span id="val-env" class="text-cyan-400">1.0</span>
                </div>
                <input type="range" id="env-intensity" min="0" max="2" step="0.1" value="1" class="slider-track">
            </div>
            
            <div class="flex items-center justify-between mt-3">
                <span class="text-xs text-gray-400">Auto-Rotate</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="auto-rotate" checked class="sr-only peer">
                    <div class="w-9 h-5 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
            </div>
        </div>
        
        <div class="mt-4 text-[10px] text-gray-500 text-center">
            Drag to rotate â€¢ Scroll to zoom
        </div>
    </div>

    <canvas id="renderCanvas"></canvas>

    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        const createScene = function () {
            const scene = new BABYLON.Scene(engine);
            
            // Camera
            const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 15, new BABYLON.Vector3(0, 0, 0), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 50;
            camera.lowerRadiusLimit = 5;
            camera.upperRadiusLimit = 50;

            // Environment Lighting (HDRI from Babylon.js assets)
            const hdrTexture = new BABYLON.CubeTexture("https://playground.babylonjs.com/textures/SpecularHDR.dds", scene);
            scene.environmentTexture = hdrTexture;
            scene.environmentIntensity = 1.0;

            // Create Street Environment using existing Babylon assets
            // Ground with asphalt material
            const ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 50, height: 50}, scene);
            const groundMat = new BABYLON.PBRMaterial("groundMat", scene);
            groundMat.albedoColor = new BABYLON.Color3(0.15, 0.15, 0.15);
            groundMat.roughness = 0.8;
            groundMat.metallic = 0.1;
            ground.material = groundMat;

            // Create street elements - buildings/planes
            const createBuilding = (x, z, width, height, depth, color) => {
                const box = BABYLON.MeshBuilder.CreateBox("building", {width, height, depth}, scene);
                box.position = new BABYLON.Vector3(x, height/2, z);
                const mat = new BABYLON.PBRMaterial("bMat", scene);
                mat.albedoColor = color;
                mat.roughness = 0.9;
                box.material = mat;
                return box;
            };

            // Street layout
            createBuilding(-15, -15, 8, 12, 8, new BABYLON.Color3(0.4, 0.35, 0.3));
            createBuilding(15, -15, 6, 18, 6, new BABYLON.Color3(0.35, 0.4, 0.35));
            createBuilding(-12, 15, 10, 10, 10, new BABYLON.Color3(0.5, 0.3, 0.3));
            createBuilding(18, 12, 7, 15, 7, new BABYLON.Color3(0.3, 0.35, 0.4));
            createBuilding(0, -20, 4, 8, 4, new BABYLON.Color3(0.45, 0.4, 0.35));
            createBuilding(-8, 8, 5, 6, 5, new BABYLON.Color3(0.4, 0.45, 0.4));

            // Road markings
            for(let i = -20; i < 20; i += 4) {
                const line = BABYLON.MeshBuilder.CreateBox("line", {width: 0.5, height: 0.05, depth: 2}, scene);
                line.position = new BABYLON.Vector3(i, 0.03, 0);
                const lineMat = new BABYLON.StandardMaterial("lineMat", scene);
                lineMat.emissiveColor = new BABYLON.Color3(0.9, 0.9, 0.8);
                line.material = lineMat;
            }

            // Two Spheres
            const spheres = [];
            
            // Gold Sphere
            const sphere1 = BABYLON.MeshBuilder.CreateSphere("sphere1", {diameter: 3}, scene);
            sphere1.position = new BABYLON.Vector3(-3, 4, 0);
            const mat1 = new BABYLON.PBRMaterial("gold", scene);
            mat1.albedoColor = new BABYLON.Color3(1.0, 0.766, 0.336);
            mat1.metallic = 1.0;
            mat1.roughness = 0.15;
            mat1.subSurface.isRefractionEnabled = false;
            sphere1.material = mat1;
            spheres.push({ mesh: sphere1, material: mat1, baseColor: mat1.albedoColor });

            // Silver Sphere
            const sphere2 = BABYLON.MeshBuilder.CreateSphere("sphere2", {diameter: 2.5}, scene);
            sphere2.position = new BABYLON.Vector3(3, 3.5, 2);
            const mat2 = new BABYLON.PBRMaterial("silver", scene);
            mat2.albedoColor = new BABYLON.Color3(0.95, 0.95, 0.97);
            mat2.metallic = 1.0;
            mat2.roughness = 0.08;
            sphere2.material = mat2;
            spheres.push({ mesh: sphere2, material: mat2, baseColor: mat2.albedoColor });

            // Enable Screen Space Reflections (SSR) for real-time reflections
            scene.enablePrePassRenderer().enableScreenspaceReflections();
            scene.getPrePassRenderer().samples = 4;

            // Post Processing for visual quality
            const pipeline = new BABYLON.DefaultRenderingPipeline(
                "defaultPipeline",
                true,
                scene,
                [camera]
            );
            pipeline.imageProcessing.toneMappingEnabled = true;
            pipeline.imageProcessing.toneMappingType = BABYLON.ImageProcessingConfiguration.TONEMAPPING_ACES;
            pipeline.imageProcessing.exposure = 1.2;
            pipeline.bloomEnabled = true;
            pipeline.bloomThreshold = 0.7;
            pipeline.bloomWeight = 0.3;
            pipeline.bloomKernel = 64;

            // Glow Layer for emissive elements
            const gl = new BABYLON.GlowLayer("glow", scene);
            gl.intensity = 0.5;

            // Animation - floating spheres
            let alpha = 0;
            scene.registerBeforeRender(() => {
                alpha += 0.01;
                sphere1.position.y = 4 + Math.sin(alpha) * 0.3;
                sphere2.position.y = 3.5 + Math.sin(alpha + 1) * 0.25;
                
                if(document.getElementById('auto-rotate').checked) {
                    camera.alpha += 0.002;
                }
            });

            return { scene, spheres, hdrTexture, camera };
        };

        const { scene, spheres, hdrTexture, camera } = createScene();

        // UI Event Listeners
        document.getElementById('met-0').addEventListener('input', (e) => {
            spheres[0].material.metallic = parseFloat(e.target.value);
            document.getElementById('val-met-0').textContent = e.target.value;
        });
        document.getElementById('rough-0').addEventListener('input', (e) => {
            spheres[0].material.roughness = parseFloat(e.target.value);
            document.getElementById('val-rough-0').textContent = e.target.value;
        });
        document.getElementById('met-1').addEventListener('input', (e) => {
            spheres[1].material.metallic = parseFloat(e.target.value);
            document.getElementById('val-met-1').textContent = e.target.value;
        });
        document.getElementById('rough-1').addEventListener('input', (e) => {
            spheres[1].material.roughness = parseFloat(e.target.value);
            document.getElementById('val-rough-1').textContent = e.target.value;
        });
        document.getElementById('env-intensity').addEventListener('input', (e) => {
            scene.environmentIntensity = parseFloat(e.target.value);
            document.getElementById('val-env').textContent = e.target.value;
        });

        engine.runRenderLoop(function () {
            scene.render();
        });

        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>